<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>不正经数据科学家</title>
  
  <subtitle>Marketing/Python/Clojure/Game</subtitle>
  <link href="https://frankchen.xyz/atom.xml" rel="self"/>
  
  <link href="https://frankchen.xyz/"/>
  <updated>2021-09-18T03:42:25.578Z</updated>
  <id>https://frankchen.xyz/</id>
  
  <author>
    <name>frankchen0130</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>发放4个pt站的邀请码：海胆之家、HDcity</title>
    <link href="https://frankchen.xyz/2021/09/18/2021-09-18-pt-invite/"/>
    <id>https://frankchen.xyz/2021/09/18/2021-09-18-pt-invite/</id>
    <published>2021-09-18T02:49:42.000Z</published>
    <updated>2021-09-18T03:42:25.578Z</updated>
    
    <content type="html"><![CDATA[<p>玩 pt 站有一段时间了，赠送4个pt站的邀请码：海胆之家、HDcity给感兴趣的朋友。</p><span id="more"></span><p><a href="https://www.haidan.video/">海胆之家</a>、<a href="https://hdcity.city/">HDcity</a>各两个：</p><p><img src="/images/1631936380423.jpg"><br><img src="/images/L20180831.22016014363i1.jpg"></p><p>留言留下邮箱和您这边关于 pt 的设备的情况（nas 等等）即可。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;玩 pt 站有一段时间了，赠送4个pt站的邀请码：海胆之家、HDcity给感兴趣的朋友。&lt;/p&gt;</summary>
    
    
    
    
    <category term="pt" scheme="https://frankchen.xyz/tags/pt/"/>
    
  </entry>
  
  <entry>
    <title>用python 自动计算亚马逊vat税款</title>
    <link href="https://frankchen.xyz/2019/10/24/amazon-vat-cal/"/>
    <id>https://frankchen.xyz/2019/10/24/amazon-vat-cal/</id>
    <published>2019-10-24T09:17:01.000Z</published>
    <updated>2021-09-14T02:41:11.928Z</updated>
    
    <content type="html"><![CDATA[<p>简述下如何使用pandas计算亚马逊英国vat税款，纯粹是pandas的业务代码。</p><span id="more"></span><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#%%</span></span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="comment">#%%</span></span><br><span class="line">vat_csv = <span class="string">r&quot;C:\Users\Administrator\Downloads\18168935102018178.csv&quot;</span></span><br><span class="line"></span><br><span class="line">df = pd.read_csv(vat_csv)</span><br><span class="line"><span class="comment">#%%</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">filter_free_tax_zone_post_code</span>(<span class="params">x : <span class="built_in">str</span></span>):</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">type</span>(x) <span class="keyword">is</span> <span class="keyword">not</span> <span class="built_in">str</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> x.startswith(<span class="string">&#x27;JE&#x27;</span>) <span class="keyword">or</span> x.startswith(<span class="string">&#x27;GY&#x27;</span>)</span><br><span class="line"><span class="comment"># # BN列邮编首字母为JE和GY的，是英国的附属岛屿，目前有免税优惠，不用计算</span></span><br><span class="line">df = df[~df[<span class="string">&#x27;ARRIVAL_POST_CODE&#x27;</span>].apply(filter_free_tax_zone_post_code)].copy()</span><br><span class="line"></span><br><span class="line"><span class="comment">#%%</span></span><br><span class="line"><span class="comment"># BO  SALE_DEPART_COUNTRY 发货国家 BP  SALE_ARRIVAL_COUNTRY 收货国家</span></span><br><span class="line"><span class="comment"># AZ TOTAL_ACTIVITY_VALUE_AMT_VAT_INCL 销售额 BA  TRANSACTION_CURRENCY_CODE 货币</span></span><br><span class="line">df[<span class="string">&#x27;SALE_DEPART_COUNTRY&#x27;</span>].value_counts()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#%%</span></span><br><span class="line">SALE_ARRIVAL_COUNTRY_ = df[<span class="string">&#x27;SALE_ARRIVAL_COUNTRY&#x27;</span>].value_counts().index</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#%%</span></span><br><span class="line">euro_nation_code_excel = <span class="string">&#x27;euro-nation-code.xlsx&#x27;</span></span><br><span class="line">euro_country = pd.read_excel(euro_nation_code_excel)[<span class="string">&#x27;CODE&#x27;</span>].values</span><br><span class="line"></span><br><span class="line"><span class="comment">#%%</span></span><br><span class="line"><span class="comment"># step 1</span></span><br><span class="line">A = df[df[<span class="string">&#x27;SALE_DEPART_COUNTRY&#x27;</span>].isin(euro_country)]</span><br><span class="line">step_1_df = A[A[<span class="string">&#x27;SALE_ARRIVAL_COUNTRY&#x27;</span>] == <span class="string">&#x27;GB&#x27;</span>]</span><br><span class="line">step_1 = step_1_df[[<span class="string">&#x27;TOTAL_ACTIVITY_VALUE_AMT_VAT_INCL&#x27;</span>, <span class="string">&#x27;TRANSACTION_CURRENCY_CODE&#x27;</span>]].groupby([<span class="string">&#x27;TRANSACTION_CURRENCY_CODE&#x27;</span>]).<span class="built_in">sum</span>()</span><br><span class="line"></span><br><span class="line">step_1 = step_1[<span class="string">&#x27;TOTAL_ACTIVITY_VALUE_AMT_VAT_INCL&#x27;</span>].to_dict()</span><br><span class="line">step_1</span><br><span class="line"><span class="comment">#%%</span></span><br><span class="line"><span class="comment"># step 2</span></span><br><span class="line">A = df[df[<span class="string">&#x27;SALE_DEPART_COUNTRY&#x27;</span>] == <span class="string">&#x27;GB&#x27;</span>]</span><br><span class="line">except_country = <span class="string">&quot;DE GB ES IT FR&quot;</span>.split(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">sub_euro_country = [i <span class="keyword">for</span> i <span class="keyword">in</span> euro_country <span class="keyword">if</span> i <span class="keyword">not</span> <span class="keyword">in</span> except_country]</span><br><span class="line">step_2_df = A[A[<span class="string">&#x27;SALE_ARRIVAL_COUNTRY&#x27;</span>] .isin(sub_euro_country)]</span><br><span class="line">step_2 = step_2_df[[<span class="string">&#x27;TOTAL_ACTIVITY_VALUE_AMT_VAT_INCL&#x27;</span>, <span class="string">&#x27;TRANSACTION_CURRENCY_CODE&#x27;</span>]].groupby([<span class="string">&#x27;TRANSACTION_CURRENCY_CODE&#x27;</span>]).<span class="built_in">sum</span>()</span><br><span class="line">step_2 = step_2[<span class="string">&#x27;TOTAL_ACTIVITY_VALUE_AMT_VAT_INCL&#x27;</span>].to_dict()</span><br><span class="line">step_2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#%%</span></span><br><span class="line"><span class="comment"># TOTAL</span></span><br><span class="line">euro2gbp = <span class="number">0.8637</span></span><br><span class="line"><span class="comment"># euro2gbp = 1 / 1.1504</span></span><br><span class="line">tax_rate = <span class="number">0.155</span></span><br><span class="line">other = <span class="number">26510.48</span></span><br><span class="line"></span><br><span class="line">euro = step_1.get(<span class="string">&#x27;EUR&#x27;</span>, <span class="number">0</span>) + step_2.get(<span class="string">&#x27;EUR&#x27;</span>, <span class="number">0</span>)</span><br><span class="line">gbp = step_1.get(<span class="string">&#x27;GBP&#x27;</span>, <span class="number">0</span>) + step_2.get(<span class="string">&#x27;GBP&#x27;</span>, <span class="number">0</span>)</span><br><span class="line">total = gbp + euro2gbp * euro</span><br><span class="line"></span><br><span class="line">vat = <span class="built_in">round</span>(total * tax_rate, <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">vat</span><br><span class="line"><span class="comment">#%%</span></span><br><span class="line">s = <span class="string">f&quot;&quot;&quot;第一步中算的英镑 <span class="subst">&#123;step_1.get(<span class="string">&#x27;GBP&#x27;</span>, <span class="number">0</span>) :<span class="number">.2</span>f&#125;</span> 欧元 <span class="subst">&#123;step_1.get(<span class="string">&#x27;EUR&#x27;</span>, <span class="number">0</span>) :<span class="number">.2</span>f&#125;</span>，</span></span><br><span class="line"><span class="string">第二步中算的英镑 <span class="subst">&#123;step_2.get(<span class="string">&#x27;GBP&#x27;</span>, <span class="number">0</span>) :<span class="number">.2</span>f&#125;</span> 欧元 <span class="subst">&#123;step_2.get(<span class="string">&#x27;EUR&#x27;</span>, <span class="number">0</span>) :<span class="number">.2</span>f&#125;</span>，</span></span><br><span class="line"><span class="string">共计 英镑 <span class="subst">&#123;gbp :<span class="number">.2</span>f&#125;</span>元，欧元<span class="subst">&#123;euro :<span class="number">.2</span>f&#125;</span>元，</span></span><br><span class="line"><span class="string">按照当前欧元兑英镑汇率为 <span class="subst">&#123;euro2gbp :<span class="number">.2</span>f&#125;</span>，</span></span><br><span class="line"><span class="string">共计英镑 <span class="subst">&#123;total :<span class="number">.2</span>f&#125;</span> 元，</span></span><br><span class="line"><span class="string">按照vat税率 <span class="subst">&#123;tax_rate&#125;</span></span></span><br><span class="line"><span class="string">计算的vat税款为 <span class="subst">&#123;vat&#125;</span> 元</span></span><br><span class="line"><span class="string">与提供的数据差值为 <span class="subst">&#123;vat - other :<span class="number">.2</span>f&#125;</span> 元</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(s)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>附赠欧盟28国的国家代码，当前（2019-10-24）英国还算是欧盟国家</p><blockquote><p>德国DE<br>荷兰NL<br>比利时BE<br>卢森堡LU<br>法国FR<br>意大利IT<br>丹麦DK<br>英国GB<br>爱尔兰IE<br>希腊GR<br>西班牙ES<br>葡萄牙PT<br>瑞典SE<br>芬兰FI<br>奥地利AT<br>塞浦路斯CY<br>爱沙尼亚EE<br>拉脱维亚LV<br>立陶宛LT<br>波兰PL<br>捷克CZ<br>斯洛伐克SK<br>斯洛文尼亚SI<br>匈牙利HU<br>马耳他MT<br>罗马尼亚RO<br>保加利亚BG<br>克罗地亚HR</p></blockquote><p>现在Pycharm对于jupyter notebook的支持也很好了，我基本上直接在IDE里面写，这个主题是Gradianto Dark Fuchsia，Jetbrains官网可以下载，PyCharm不是只有Darcula的，好了，我大约一年没有更了，现在正式回归了，我现在做的是电商行业，以后我也许会更多的是生产力软件、爬虫与数据分析、企业系统方面转了，从来就不是正经的数据科学家。生命过程很复杂很丰富，继续做个顽强的人，祝大家<strong>1024程序员节快乐</strong>，我还算程序员的吧🤣哈哈哈</p><p><img src="/images/vat-auto.png"></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;简述下如何使用pandas计算亚马逊英国vat税款，纯粹是pandas的业务代码。&lt;/p&gt;</summary>
    
    
    
    
    <category term="Deep Learning" scheme="https://frankchen.xyz/tags/Deep-Learning/"/>
    
    <category term="python" scheme="https://frankchen.xyz/tags/python/"/>
    
    <category term="amazon" scheme="https://frankchen.xyz/tags/amazon/"/>
    
    <category term="pandas" scheme="https://frankchen.xyz/tags/pandas/"/>
    
  </entry>
  
  <entry>
    <title>python 发送带各种附件的邮件示例</title>
    <link href="https://frankchen.xyz/2018/12/20/attachments/"/>
    <id>https://frankchen.xyz/2018/12/20/attachments/</id>
    <published>2018-12-20T12:47:39.000Z</published>
    <updated>2018-12-20T13:04:56.555Z</updated>
    
    <content type="html"><![CDATA[<p>简述下如何使用python发送各种附件的邮件，比如word、excel、pdf、txt，以及在正文插入图片等等</p><span id="more"></span><p>如下所示，</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> smtplib</span><br><span class="line"><span class="keyword">from</span> email.mime.text <span class="keyword">import</span> MIMEText</span><br><span class="line"><span class="keyword">from</span> email.header <span class="keyword">import</span> Header</span><br><span class="line"><span class="keyword">from</span> smtplib <span class="keyword">import</span> SMTP_SSL</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> email.mime.image <span class="keyword">import</span> MIMEImage</span><br><span class="line"><span class="keyword">from</span> email.mime.multipart <span class="keyword">import</span> MIMEMultipart</span><br><span class="line"><span class="keyword">from</span> email.mime.application <span class="keyword">import</span> MIMEApplication</span><br><span class="line"><span class="keyword">from</span> email.mime.text <span class="keyword">import</span> MIMEText</span><br><span class="line"><span class="keyword">from</span> email.mime.base <span class="keyword">import</span> MIMEBase</span><br><span class="line"><span class="keyword">from</span> email.encoders <span class="keyword">import</span> encode_base64</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> traceback</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">send_mail</span>(<span class="params">mail_title,</span></span></span><br><span class="line"><span class="params"><span class="function">              mail_content=<span class="literal">None</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">              attachment_img=<span class="literal">None</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">              attachment_txt=<span class="literal">None</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">              attachment_pdf=<span class="literal">None</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">              attachment_excel=<span class="literal">None</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">              attachment_word=<span class="literal">None</span></span>):</span></span><br><span class="line">    <span class="comment"># qq邮箱smtp服务器</span></span><br><span class="line">    host_server = <span class="string">&#x27;smtp.qq.com&#x27;</span></span><br><span class="line">    <span class="comment"># sender_qq为发件人的qq号码</span></span><br><span class="line">    sender_qq = <span class="string">&#x27;947118251&#x27;</span></span><br><span class="line">    <span class="comment"># pwd为qq邮箱的授权码</span></span><br><span class="line">    pwd = <span class="string">&#x27;tvjl******zpbebb&#x27;</span></span><br><span class="line">    <span class="comment"># 发件人的邮箱</span></span><br><span class="line">    sender_qq_mail = <span class="string">&#x27;947118251@qq.com&#x27;</span></span><br><span class="line">    <span class="comment"># 收件人邮箱</span></span><br><span class="line">    <span class="comment"># receiver = &#x27;znwindy@gmail.com&#x27;</span></span><br><span class="line">    receiver = <span class="string">&#x27;947118251@qq.com&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># ssl登录</span></span><br><span class="line">        smtp = SMTP_SSL(host_server)</span><br><span class="line">        <span class="comment"># set_debuglevel()是用来调试的。参数值为1表示开启调试模式，参数值为0关闭调试模式</span></span><br><span class="line">        smtp.set_debuglevel(<span class="number">1</span>)</span><br><span class="line">        smtp.ehlo(host_server)</span><br><span class="line">        smtp.login(sender_qq, pwd)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># msg = MIMEText(mail_content, &quot;plain&quot;, &#x27;utf-8&#x27;)</span></span><br><span class="line">        msg = MIMEMultipart(<span class="string">&#x27;related&#x27;</span>)</span><br><span class="line">        msg[<span class="string">&quot;Subject&quot;</span>] = Header(mail_title, <span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">        msg[<span class="string">&quot;From&quot;</span>] = sender_qq_mail</span><br><span class="line">        msg[<span class="string">&quot;To&quot;</span>] = receiver</span><br><span class="line"></span><br><span class="line">        msgAlternative = MIMEMultipart(<span class="string">&#x27;alternative&#x27;</span>)</span><br><span class="line">        msg.attach(msgAlternative)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># image attach</span></span><br><span class="line">        <span class="keyword">if</span> attachment_img:</span><br><span class="line">            mail_body = <span class="string">&#x27;&lt;b&gt;%s&lt;/b&gt;&lt;br&gt;&lt;img src=&quot;cid:%s&quot;&gt;&lt;br&gt;&#x27;</span> % (mail_content, attachment_img)</span><br><span class="line">            msgText = (MIMEText(mail_body, <span class="string">&#x27;html&#x27;</span>, <span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">            msgAlternative.attach(msgText)</span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(attachment_img, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> fp:</span><br><span class="line">                msgImage = MIMEImage(fp.read())</span><br><span class="line">            msgImage.add_header(<span class="string">&#x27;Content-ID&#x27;</span>, <span class="string">&#x27;&lt;&#123;&#125;&gt;&#x27;</span>.<span class="built_in">format</span>(attachment_img))</span><br><span class="line">            msg.attach(msgImage)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># txt attach</span></span><br><span class="line">        <span class="keyword">if</span> attachment_txt:</span><br><span class="line">            file_name = os.path.split(attachment_txt)[<span class="number">1</span>]</span><br><span class="line">            att1 = MIMEText(<span class="built_in">open</span>(attachment_txt, <span class="string">&#x27;rb&#x27;</span>).read(), <span class="string">&#x27;base64&#x27;</span>, <span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">            att1[<span class="string">&quot;Content-Type&quot;</span>] = <span class="string">&#x27;application/octet-stream&#x27;</span></span><br><span class="line">            <span class="comment"># 这里的filename可以任意写，写什么名字，邮件中显示什么名字</span></span><br><span class="line">            att1[<span class="string">&quot;Content-Disposition&quot;</span>] = <span class="string">f&#x27;attachment; filename=&quot;<span class="subst">&#123;file_name&#125;</span>&quot;&#x27;</span></span><br><span class="line">            msg.attach(att1)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># pdf attach</span></span><br><span class="line">        <span class="keyword">if</span> attachment_pdf:</span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(attachment_pdf, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> fp:</span><br><span class="line">                fileMsg = MIMEBase(<span class="string">&#x27;application&#x27;</span>, <span class="string">&#x27;pdf&#x27;</span>)</span><br><span class="line">                fileMsg.set_payload(fp.read())</span><br><span class="line">                encode_base64(fileMsg)</span><br><span class="line">                fileMsg.add_header(<span class="string">&#x27;Content-Disposition&#x27;</span>, <span class="string">f&#x27;attachment;filename=<span class="subst">&#123;os.path.split(attachment_pdf)[<span class="number">1</span>]&#125;</span>&#x27;</span>)</span><br><span class="line">                msg.attach(fileMsg)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># excel attach</span></span><br><span class="line">        <span class="keyword">if</span> attachment_excel:</span><br><span class="line">            part = MIMEBase(<span class="string">&#x27;application&#x27;</span>, <span class="string">&quot;vnd.ms-excel&quot;</span>)</span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(attachment_excel, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> fp:</span><br><span class="line">                part.set_payload(fp.read())</span><br><span class="line">                encode_base64(part)</span><br><span class="line">                part.add_header(<span class="string">&#x27;Content-Disposition&#x27;</span>, <span class="string">f&#x27;attachment; filename=&quot;<span class="subst">&#123;os.path.split(attachment_excel)[<span class="number">1</span>]&#125;</span>&quot;&#x27;</span>)</span><br><span class="line">                msg.attach(part)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># word attach</span></span><br><span class="line">        <span class="keyword">if</span> attachment_word:</span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(attachment_word, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> fp:</span><br><span class="line">                part = MIMEApplication(fp.read())</span><br><span class="line">                part.add_header(<span class="string">&#x27;Content-Disposition&#x27;</span>, <span class="string">f&#x27;attachment; filename=&quot;<span class="subst">&#123;os.path.split(attachment_word)[<span class="number">1</span>]&#125;</span>&quot;&#x27;</span>)</span><br><span class="line">                part.set_charset(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">                msg.attach(part)</span><br><span class="line"></span><br><span class="line">        smtp.sendmail(sender_qq_mail, receiver, msg.as_string())</span><br><span class="line">        smtp.quit()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Success!&#x27;</span>)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Error!&#x27;</span>)</span><br><span class="line">        traceback.print_exc()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    send_mail(mail_title=<span class="string">&#x27;爬虫结束了，正常退出!&#x27;</span>,</span><br><span class="line">              mail_content=<span class="string">&#x27;你好，这是使用python登录qq邮箱发邮件的测试&#x27;</span>,</span><br><span class="line">              attachment_img=<span class="string">&#x27;../data/test.jpg&#x27;</span>,</span><br><span class="line">              attachment_txt=<span class="string">&#x27;../data/start_urls.txt&#x27;</span>,</span><br><span class="line">              attachment_pdf=<span class="string">&#x27;../data/Gmail - How to add images in the product description_.pdf&#x27;</span>,</span><br><span class="line">              attachment_excel=<span class="string">&#x27;../data/shops.xlsx&#x27;</span>,</span><br><span class="line">              attachment_word=<span class="string">&#x27;../data/asdasd.docx&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;简述下如何使用python发送各种附件的邮件，比如word、excel、pdf、txt，以及在正文插入图片等等&lt;/p&gt;</summary>
    
    
    
    
    <category term="python" scheme="https://frankchen.xyz/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>PyQt5 编写并在Windows上用Cx_Freeze打包GUI程序</title>
    <link href="https://frankchen.xyz/2018/09/11/Pyqt5-GUI-package-on-Windows/"/>
    <id>https://frankchen.xyz/2018/09/11/Pyqt5-GUI-package-on-Windows/</id>
    <published>2018-09-11T14:51:05.000Z</published>
    <updated>2018-09-11T15:08:59.888Z</updated>
    
    <content type="html"><![CDATA[<p>简述下如何在Windows上用Cx_Freeze正确打包GUI程序</p><span id="more"></span><p>为了防止出现&gt; This application failed to start because it could not find or load the Qt platform plugin “windows” 错误，如<a href="https://pythonexample.com/code/cx_freeze-pyqt5">Cx_Freeze Pyqt5 - pythonexample.com</a>这里简述的，我们需要PyQt5的库位置</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> cx_Freeze <span class="keyword">import</span> setup, Executable</span><br><span class="line"></span><br><span class="line">path_platforms = ( <span class="string">&quot;C:\\Users\\zhaon\\Anaconda3\\pkgs\\qt-5.9.5-vc14he4a7d60_0\\Library\\plugins\\platforms\\qwindows.dll&quot;</span>, <span class="string">&quot;platforms\qwindows.dll&quot;</span> )</span><br><span class="line">includefiles = [path_platforms]</span><br><span class="line"><span class="comment"># Dependencies are automatically detected, but it might need fine tuning.</span></span><br><span class="line">build_exe_options = &#123;<span class="string">&quot;packages&quot;</span>: [<span class="string">&quot;os&quot;</span>],</span><br><span class="line">                     <span class="string">&quot;excludes&quot;</span>: [<span class="string">&quot;tkinter&quot;</span>],</span><br><span class="line">                     <span class="string">&quot;include_files&quot;</span>: includefiles,&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># GUI applications require a different base on Windows (the default is for a</span></span><br><span class="line"><span class="comment"># console application).</span></span><br><span class="line">base = <span class="literal">None</span></span><br><span class="line"><span class="keyword">if</span> sys.platform == <span class="string">&quot;win64&quot;</span>:</span><br><span class="line">    base = <span class="string">&quot;Win64GUI&quot;</span></span><br><span class="line"></span><br><span class="line">setup(name=<span class="string">&quot;QuickJump&quot;</span>,</span><br><span class="line">      version=<span class="string">&quot;0.9&quot;</span>,</span><br><span class="line">      description=<span class="string">&quot;application!&quot;</span>,</span><br><span class="line">      options=&#123;<span class="string">&quot;build_exe&quot;</span>: build_exe_options&#125;,</span><br><span class="line">      executables=[Executable(<span class="string">&quot;app.py&quot;</span>, base=base)])</span><br></pre></td></tr></table></figure><p>再<code>python setup.py bdist_msi</code>即可打包msi安装包。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;简述下如何在Windows上用Cx_Freeze正确打包GUI程序&lt;/p&gt;</summary>
    
    
    
    
    <category term="PyQt5" scheme="https://frankchen.xyz/tags/PyQt5/"/>
    
  </entry>
  
  <entry>
    <title>Numpy中的mask</title>
    <link href="https://frankchen.xyz/2018/07/20/numpy-mask/"/>
    <id>https://frankchen.xyz/2018/07/20/numpy-mask/</id>
    <published>2018-07-20T08:48:48.000Z</published>
    <updated>2018-07-20T09:03:43.000Z</updated>
    
    <content type="html"><![CDATA[<p>numpy中矩阵选取子集或者以条件替换，用mask是一种很好的方法</p><span id="more"></span><p>简单来说就是用bool类型的indice矩阵去选择，</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mask = np.ones(X.shape[<span class="number">0</span>], dtype=<span class="built_in">bool</span>)</span><br><span class="line">X[mask].shape</span><br><span class="line">mask.shape</span><br><span class="line">mask[indices[<span class="number">0</span>]] = <span class="literal">False</span></span><br><span class="line">mask.shape</span><br><span class="line">X[mask].shape</span><br><span class="line">X[~mask].shape</span><br><span class="line">(<span class="number">678</span>, <span class="number">2</span>)</span><br><span class="line">(<span class="number">678</span>,)</span><br><span class="line">(<span class="number">678</span>,)</span><br><span class="line">(<span class="number">675</span>, <span class="number">2</span>)</span><br><span class="line">(<span class="number">3</span>, <span class="number">2</span>)</span><br></pre></td></tr></table></figure><p>例如我们这里用来选取全部点中KNN选取的点以及所有剩余的点</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.neighbors <span class="keyword">import</span> NearestNeighbors</span><br><span class="line">nbrs = NearestNeighbors(<span class="number">10</span>).fit(X)</span><br><span class="line">_,indices = nbrs.kneighbors(X)</span><br><span class="line">mask = np.ones(X.shape[<span class="number">0</span>], dtype=<span class="built_in">bool</span>)</span><br><span class="line">mask[indices[<span class="number">0</span>]] = <span class="literal">False</span></span><br><span class="line">plt.scatter(X[mask][:,<span class="number">0</span>],X[mask][:,<span class="number">1</span>],c=<span class="string">&#x27;g&#x27;</span>)</span><br><span class="line">plt.scatter(X[~mask][:,<span class="number">0</span>],X[~mask][:,<span class="number">1</span>],c=<span class="string">&#x27;r&#x27;</span>)</span><br></pre></td></tr></table></figure><p><img src="/images/15320771581233.jpg"></p><p>带条件选择替换，比如我们需要将a矩阵内某条件的行置换为888剩余置换为999，可以直接用mask或者再用where一步搞定：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mask = np.ones(a.shape,dtype=<span class="built_in">bool</span>) <span class="comment">#np.ones_like(a,dtype=bool)</span></span><br><span class="line">mask[indices] = <span class="literal">False</span></span><br><span class="line">a[~mask] = <span class="number">999</span></span><br><span class="line">a[mask] = <span class="number">888</span></span><br><span class="line"><span class="comment">#############</span></span><br><span class="line">np.where(mask, <span class="number">888</span>, <span class="number">999</span>)</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;numpy中矩阵选取子集或者以条件替换，用mask是一种很好的方法&lt;/p&gt;</summary>
    
    
    
    
    <category term="Numpy" scheme="https://frankchen.xyz/tags/Numpy/"/>
    
  </entry>
  
  <entry>
    <title>为什么我每天早上5:30起床</title>
    <link href="https://frankchen.xyz/2018/07/19/Why-I-Wake-Up-at-5-30-am-Every-Morning-And-What-You-Will-Gain-From-Doing-It-Too/"/>
    <id>https://frankchen.xyz/2018/07/19/Why-I-Wake-Up-at-5-30-am-Every-Morning-And-What-You-Will-Gain-From-Doing-It-Too/</id>
    <published>2018-07-19T00:52:23.000Z</published>
    <updated>2018-07-19T01:31:24.000Z</updated>
    
    <content type="html"><![CDATA[<p>几个月前，我做出一个对我来说完全不合时宜，几个月内会产生日常影响的决定。</p><p>决定就是在每天早上5:30醒来。</p><p><img src="/images/15319616493254.gif"></p><span id="more"></span><p>“为什么？”</p><p>这是一个合理的问题。 （我必须承认，有些早晨，我问自己同样的问题。）</p><p>你有没有醒过来觉得你完全没有了？你睁开眼睛，你就会因怨恨而战胜。你会立即想象你无情的待办事项清单，你背后的一切，以及所有必须达到的最后期限。</p><p>结果：每天早上醒来，希望你可以在床上度过余下的一天。</p><p>我不了解你，但在我的余生中每天都开始这样做？不，谢谢。</p><p>然后我发现了Hal Elrod的奇迹早晨，以及<a href="http://uk.businessinsider.com/successful-tech-people-who-wake-up-reall-early-2015-8?r=US&IR=T">一些最成功的企业家的早晨例程</a>。</p><p>如果成千上万的The Miracle Morning粉丝，以及像Richard Branson（Virgin的创始人兼首席执行官），Tim Cook（Apple首席执行官），Howard Schulz（星巴克首席执行官）和Jack Dorsey（Twitter创始人兼首席执行官）等人和广场）努力做到这一点，必须有一些东西，对吧？</p><p>这不是为了在太阳之前在5:30起床（我喜欢我的床和下一个人一样）。这是关于有时间完成活动，这些活动已知会对我们的心理状态，效率和（顺便提一下）我们的幸福水平产生相当积极的影响。</p><p>如果以热情的热情开始新的一天，并且想要充分利用它的想法吸引你，这就是我采用的惯例，很大程度上受到了哈尔·埃尔罗德在“奇迹早晨”中提出的建议的启发。<br>（重要提示：早上5点半醒来并不是强制性的。为了有时间进行这些活动，只需要比平常早起来就足够了。</p><h2 id="清醒你的思想和专心"><a href="#清醒你的思想和专心" class="headerlink" title="清醒你的思想和专心"></a>清醒你的思想和专心</h2><p>我们即将谈论冥想。关于冥想益处的科学证据正在增长。</p><p>冥想不一定是盘腿坐在地板上整整一个小时。经常练习五分钟的冥想会给你同样的好处。</p><p>我测试了两个可以在一开始就指导您的应用程序：</p><ul><li>Headspace（无可挑剔的用户体验设计！）</li><li>Calm（我目前使用的是什么）</li></ul><p>在The Miracle Morning中，Hal Elrod给出了一个简单的技巧：</p><ul><li>找一个舒适的地方，坐直。</li><li>闭上眼睛或盯着你面前的固定点。</li><li>专注于你的呼吸;从你的腹部吸气，通过胸部呼气。</li><li>欣赏平静;尽量专注于你的呼吸，不要想其他任何事情。当你的思绪徘徊到流浪的思绪时，不要惊慌失措，平静地将你的焦点吸回你的呼吸。<br>优点：</li></ul><p>你感到压力减轻，你获得了安心。经过一些练习，一旦你在那10分钟后重新睁开眼睛，你会真正感觉到你处于不同的心态。</p><h2 id="写"><a href="#写" class="headerlink" title="写"></a>写</h2><p>每天早上花点时间写几分钟，真的可以帮到你。它允许您评估您的当前状态，并重新关注重要的事情。</p><p>你可以，例如：</p><ul><li>写下你感恩的三件事：亲密的朋友和家人，一些好消息，美好的回忆或成就。</li><li>写下你当时的想法。</li><li>写下你想在白天完成的一切。</li><li>写下一条激励你或你想要记住的引语。</li><li>记下你最近学到的一件事或者你有一个顿悟。</li><li>一开始我曾经写过一个空白的Moleskine笔记本。然后我使用了一种特殊的日记（不是那些14岁小孩用的小心脏的日记）。今天，我正在制作自己的期刊。它将有一个特殊的布局，我可以回答预定义的每日问题。</li></ul><p>优点：</p><p>你会感到更快乐，更专注。做这个练习也可以帮助你记录你的进步，以及你生活中所有积极的事情。</p><h2 id="提醒自己你的目标"><a href="#提醒自己你的目标" class="headerlink" title="提醒自己你的目标"></a>提醒自己你的目标</h2><p>有几种方法可以做到这一点。您可以选择其中之一或三者的组合。</p><ul><li>誓词。这些是可重复的短语，描述了您想成为的人。</li><li>可视化。想象一下自己正在完成你想要完成的事情，享受美好的一天。想象并想象您将体验到的感受。</li><li>提醒目标。这是抽出我们之前讨论过的每周工作表的时刻。您还可以花点时间写下您的目标并提醒您自己想要完成它们的原因。例如：“与家人共度美好的一天 - 因为他们是我的首要任务。”<br>我第一次听到肯定和可视化时的初步反应：<br>（起初我有一点肯定和可视化方面有点麻烦。当你最初开始尝试它们时，你会感觉到你已经落在其中一个美国大会的中间，在那里演讲者告诉你你是多么美妙，以及如何改变世界…但最终，我已经习惯了他们。）</li></ul><h2 id="动起来-！"><a href="#动起来-！" class="headerlink" title="动起来 ！"></a>动起来 ！</h2><p>这是我日常动机的镜头！它让我想起了我想做什么，为什么要这样做，以及我将如何去做。</p><p>成功人士经常锻炼是有原因的。这是因为他们意识到他们需要在游戏中处于领先地位，以实现他们的目标，并且每天都充分发挥作用。</p><p>蒂姆库克每天凌晨5点去健身房，或者杰克多尔西跑10公里开始他的休息日并不奇怪。</p><p>如果您想在没有购买任何设备的情况下开始，无需加入健身房，也没有承诺，您可以举例：</p><p>去跑步，即使你开始10-15分钟<br>做一个着名的七分钟训练（例如这个 -  <a href="https://itunes.apple.com/en/app/7-minute-workout/id650762525?mt=8%EF%BC%89">https://itunes.apple.com/en/app/7-minute-workout/id650762525?mt=8）</a></p><p>每天早上做一点是理想的。但我发现最有用的是每隔一个早晨锻炼一个半小时。当我不锻炼时，我休息。最后，当我不去健身房时，我希望能够做10分钟的瑜伽。</p><p>优点：</p><p>早上进行某种形式的身体活动，即使只进行10分钟的运动，也可以让你完全醒来，放松压力，充满活力。哦是的，它也很健康。非常好，对吧</p><h2 id="读"><a href="#读" class="headerlink" title="读"></a>读</h2><p>您可以随意使用无限的知识来源：书籍。无论你想要完成什么：跑马拉松，致富，环游世界……有关于这个主题的书籍可以提供相当大的帮助。</p><p>每天早上阅读20分钟（甚至10分钟）意味着吸收知识，你可以立即付诸实践，更接近实现目标。</p><p>我经常写一些对我来说最有用的书籍摘要。</p><p>一些对我产生真正影响的书籍的例子：</p><ul><li>Tim Ferris的The 4-Hour Workweek（阅读它以大大提高您的工作效率）</li><li>Dale Carnegie 的How to Win Friends and Influence People （无疑是关于人际交往和情商的最佳现存书籍）</li><li>Chris Guillebeau的The100 Startup（向您展示如何在追求激情的同时获得良好的生活）</li><li>The Power of Less：将自己限制在商业和生活中必不可少的美术Leo Babauta（教你消除不必要的更多）</li></ul><p><strong>😎站长推荐：外文原版电子书推荐下载网站<a href="http://gen.lib.rus.ec/">Library Genesis</a></strong><br><img src="/images/15319638830117.jpg"></p><p>优点：</p><p>为什么不从成功人士的经验中学习呢？你会节省很多时间。你会丰富自己。通过分享您学到的所有知识，您将能够帮助身边的人。</p><p>我已经练习了几个月的这种仪式，这里有一些好处：</p><ul><li>我从未读过那么多，因此学到了很多东西！ （我也在早晨的仪式之外阅读）</li><li>我（最终）成功地致力于定期锻炼（这个奇迹一下）</li><li>我知道我想去哪里，为什么（即使“如何”仍然含糊不清）<br>顺便说一句，我在早上6:10写了这篇文章。我刚刚完成了早上的仪式，我已经开始完成当天的第一项任务了：写这篇文章！</li></ul><p>我只能鼓励你给自己每天开始的机会，而不是迟到和压力，但要照顾好自己，充满动力，并决心充分利用每一分钟。</p><h2 id="你的待办事项列表，如果你愿意的话"><a href="#你的待办事项列表，如果你愿意的话" class="headerlink" title="你的待办事项列表，如果你愿意的话"></a>你的待办事项列表，如果你愿意的话</h2><ul><li>对于你们中间的核心：明天早上比平常提前一小时设置你的闹钟，并且每次这些活动都要做10分钟。</li><li>对于那些喜欢慢慢做的人：选择两三个对你有吸引力的任务，并明天早上开始做。</li><li>他们说，为了在你的生活中建立一个新的习惯，你必须通过“21天大关。”如果你想冒险，你知道你必须做什么。</li></ul><h2 id="译者的话"><a href="#译者的话" class="headerlink" title="译者的话"></a>译者的话</h2><p>我尝试了许多传说中对于早期有帮助的APP，许多的理念基于强制性的让你做一些动作（比如强迫扫码你的牙膏）来消除你的睡意，不过我认为这种理念本来就是不对的，惹急了用户要睡删了APP不就行了？！😂<br>现在我用的感觉很成功的一款APP叫做<a href="https://www.sleepcycle.com/">Sleep Cycle alarm clock</a>，基于在你浅睡眠的时候叫醒的这个理念，保证闹铃响起的时候起床概率超高！<br>比如下图，我定了5：30的闹钟，那么APP会探测我在5：00~5：30之间的一个浅睡眠时刻叫醒我。<br><img src="/images/15319625280582.jpg"></p><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://www.huffingtonpost.com/entry/why-i-wake-up-at-530-am-e_b_8055880">Why I Wake Up at 5:30 am Every Morning (And What You Will Gain From Doing It Too) | HuffPost</a></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;几个月前，我做出一个对我来说完全不合时宜，几个月内会产生日常影响的决定。&lt;/p&gt;
&lt;p&gt;决定就是在每天早上5:30醒来。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/15319616493254.gif&quot;&gt;&lt;/p&gt;</summary>
    
    
    
    
    <category term="chicken-soup" scheme="https://frankchen.xyz/tags/chicken-soup/"/>
    
  </entry>
  
  <entry>
    <title>Datacamp Git 笔记</title>
    <link href="https://frankchen.xyz/2018/07/13/Datacamp-Git-Nones/"/>
    <id>https://frankchen.xyz/2018/07/13/Datacamp-Git-Nones/</id>
    <published>2018-07-13T09:14:07.000Z</published>
    <updated>2018-07-19T03:35:59.000Z</updated>
    
    <content type="html"><![CDATA[<p>最近入了<a href="https://item.taobao.com/item.htm?spm=a1z09.2.0.0.11752e8diqYgI7&id=565426495436&_u=dn2i5bf6736">elecomI Pad贴膜</a>后用iPad写字感觉超棒！🐱<br>这里是一段DataCamp上的Git课程的笔记，当然这是免费课程，其实我领取<a href="http://www.10tiao.com/html/407/201801/2650545581/1.html">微软送的的两月DataCamp会员</a>过期了。。。😡</p><span id="more"></span><p>这就是[elecomI 的Pad贴膜]<br><img src="/images/15319713559370.jpg"></p><p><img src="/images/IMG_0150.png" alt="IMG_0150"><br><img src="/images/IMG_0151.png" alt="IMG_0151"></p><p>后续有更新再补充~</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;最近入了&lt;a href=&quot;https://item.taobao.com/item.htm?spm=a1z09.2.0.0.11752e8diqYgI7&amp;id=565426495436&amp;_u=dn2i5bf6736&quot;&gt;elecomI Pad贴膜&lt;/a&gt;后用iPad写字感觉超棒！🐱&lt;br&gt;这里是一段DataCamp上的Git课程的笔记，当然这是免费课程，其实我领取&lt;a href=&quot;http://www.10tiao.com/html/407/201801/2650545581/1.html&quot;&gt;微软送的的两月DataCamp会员&lt;/a&gt;过期了。。。😡&lt;/p&gt;</summary>
    
    
    
    
    <category term="git" scheme="https://frankchen.xyz/tags/git/"/>
    
  </entry>
  
  <entry>
    <title>在Linux上重新映射Win，Ctrl和Alt键</title>
    <link href="https://frankchen.xyz/2018/07/12/remap-win-ctrl-and-alt-keys-on-linux/"/>
    <id>https://frankchen.xyz/2018/07/12/remap-win-ctrl-and-alt-keys-on-linux/</id>
    <published>2018-07-12T08:43:42.000Z</published>
    <updated>2018-07-12T08:54:35.000Z</updated>
    
    <content type="html"><![CDATA[<p>用惯了Mac上的CMD + * 等操作，就习惯了左手大拇指这个组合键操作了，切换到Linux上必须要Ctrl各种小指不舒服。。。值得一提的是Mac上左侧按键顺序是control、alt/option、command，Ubuntu则是control、super、alt，Windows则是control、Win、alt。这里我们方便Mac用户起见，就把Ubuntu的control、super、alt映射为super、alt、control</p><span id="more"></span><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.Xmodmap</span><br><span class="line"></span><br><span class="line">clear control</span><br><span class="line">clear mod1</span><br><span class="line">clear mod4</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">keycode 37  = Super_L     </span><br><span class="line">! left  Ctrl becomes Super</span><br><span class="line">keycode 64  = Control_L</span><br><span class="line">! left  Alt  becomes Control </span><br><span class="line">keycode 133 = Alt_L Meta_L</span><br><span class="line">! left  Win  becomes Alt</span><br><span class="line">keycode 108 = Control_R</span><br><span class="line">! right Alt  becomes Control </span><br><span class="line">keycode 134 = Alt_R Meta_R</span><br><span class="line">! right Win  becomes Alt</span><br><span class="line">keycode 105 = Super_R</span><br><span class="line">! right Ctrl becomes Super</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">add control = Control_L Control_R</span><br><span class="line">add mod1 = Alt_L Meta_L</span><br><span class="line">add mod4 = Super_L Super_R</span><br></pre></td></tr></table></figure><p>再<code>xmodmap ~/.Xmodmap</code>即可！</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;用惯了Mac上的CMD + * 等操作，就习惯了左手大拇指这个组合键操作了，切换到Linux上必须要Ctrl各种小指不舒服。。。值得一提的是Mac上左侧按键顺序是control、alt/option、command，Ubuntu则是control、super、alt，Windows则是control、Win、alt。这里我们方便Mac用户起见，就把Ubuntu的control、super、alt映射为super、alt、control&lt;/p&gt;</summary>
    
    
    
    
    <category term="Linux" scheme="https://frankchen.xyz/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>Mac 双开 ss 方法</title>
    <link href="https://frankchen.xyz/2018/05/31/dual-ss-on-mac/"/>
    <id>https://frankchen.xyz/2018/05/31/dual-ss-on-mac/</id>
    <published>2018-05-31T11:24:17.000Z</published>
    <updated>2018-07-12T09:25:56.000Z</updated>
    
    <content type="html"><![CDATA[<p>有时候我们需要两个代理，譬如一个用来连需要经过跳板机代理的集群服务，一个则用来科学上网，不停切换麻烦且代价比较高，那我们除了ShadowsocksX-NG客户端之外，我们可以用命令行的方式再开启一个，</p><span id="more"></span><p><img src="/images/15277663104280.jpg"></p><p><img src="/images/15277666370736.jpg"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用Homebrew安装</span></span><br><span class="line">brew install shadowsocks-libev</span><br><span class="line"><span class="comment"># 编辑配置信息</span></span><br><span class="line">sudo vim /usr/<span class="built_in">local</span>/etc/shadowsocks-libev.json</span><br><span class="line"><span class="comment"># 格式如下，注意与ShadowsocksX-NG的local_port也就是socks5不同</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;server&quot;</span>:<span class="string">&quot;107.167.185.234&quot;</span>,</span><br><span class="line">    <span class="string">&quot;server_port&quot;</span>:11499,</span><br><span class="line">    <span class="string">&quot;local_port&quot;</span>:1079,</span><br><span class="line">    <span class="string">&quot;password&quot;</span>:<span class="string">&quot;xxxxxxxx&quot;</span>,</span><br><span class="line">    <span class="string">&quot;timeout&quot;</span>:600,</span><br><span class="line">    <span class="string">&quot;method&quot;</span>:<span class="string">&quot;aes-256-gcm&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># 重启 shadowsocks-libev，会自动添加开机自启</span></span><br><span class="line">brew services restart shadowsocks-libev</span><br></pre></td></tr></table></figure><p>再在SwitchyOmega里面设置两个不同的代理即可，<br><img src="/images/15277663992132.jpg"></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;有时候我们需要两个代理，譬如一个用来连需要经过跳板机代理的集群服务，一个则用来科学上网，不停切换麻烦且代价比较高，那我们除了ShadowsocksX-NG客户端之外，我们可以用命令行的方式再开启一个，&lt;/p&gt;</summary>
    
    
    
    
    <category term="Mac" scheme="https://frankchen.xyz/tags/Mac/"/>
    
  </entry>
  
  <entry>
    <title>从 Hive 获取数据到本地的方法 🦄</title>
    <link href="https://frankchen.xyz/2018/05/03/get-table-from-spark/"/>
    <id>https://frankchen.xyz/2018/05/03/get-table-from-spark/</id>
    <published>2018-05-03T12:51:14.000Z</published>
    <updated>2018-08-21T09:34:02.661Z</updated>
    
    <content type="html"><![CDATA[<p>我们使用pyspark 读取Hive里的表格，存储到HDFS，再get到跳板机，再rsync到本地，再用dask读取为Dataframe。</p><span id="more"></span><h2 id="第一版"><a href="#第一版" class="headerlink" title="第一版"></a>第一版</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"> <span class="number">1</span> <span class="keyword">from</span> pyspark.sql <span class="keyword">import</span> *</span><br><span class="line"> <span class="number">2</span> <span class="keyword">import</span> pyspark</span><br><span class="line"> <span class="number">3</span> <span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line"> <span class="number">4</span>     spark = SparkSession.builder.master(<span class="string">&quot;yarn&quot;</span>).appName(<span class="string">&quot;pyspark location process&quot;</span>).enableHiveSupport().getOrCreate()</span><br><span class="line"> <span class="number">5</span>     sc = spark.sparkContext</span><br><span class="line"> <span class="number">6</span>    <span class="comment"># spark.sql(&#x27;show databases&#x27;).show()</span></span><br><span class="line"> <span class="number">7</span>     spark.sql(<span class="string">&#x27;use annals&#x27;</span>).show()</span><br><span class="line"> <span class="number">8</span>    <span class="comment"># spark.sql(&#x27;describe gps2&#x27;).show()</span></span><br><span class="line"> <span class="number">9</span>     spark.sql(<span class="string">&#x27;select * from gps2 limit 1&#x27;</span>).show()</span><br><span class="line"><span class="number">10</span>     sql_df = spark.sql(<span class="string">&#x27;select uid, lat, lgt, app_adjust_time from gps2 limit 5&#x27;</span>)</span><br><span class="line"><span class="number">11</span>     <span class="comment">#sql_df.show()</span></span><br><span class="line"><span class="number">12</span>     <span class="built_in">print</span>(<span class="built_in">type</span>(sql_df))</span><br><span class="line"><span class="number">13</span>     sql_df.write.save(<span class="string">&quot;data/GrMWKfDj9eIjsRuh.parquet&quot;</span>)</span><br></pre></td></tr></table></figure><h2 id="第二版"><a href="#第二版" class="headerlink" title="第二版"></a>第二版</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># find pyspark and import</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> gc </span><br><span class="line">os.environ[<span class="string">&#x27;SPARK_HOME&#x27;</span>] = <span class="string">&quot;/opt/cloudera/parcels/SPARK2/lib/spark2&quot;</span></span><br><span class="line">sys.path.append(os.path.join(<span class="string">&quot;/home/ubuntu/data/pythonpackage&quot;</span>))</span><br><span class="line">sys.path.append(os.path.join(os.environ[<span class="string">&#x27;SPARK_HOME&#x27;</span>], <span class="string">&quot;python&quot;</span>))</span><br><span class="line">sys.path.append(os.path.join(os.environ[<span class="string">&#x27;SPARK_HOME&#x27;</span>], <span class="string">&quot;python/lib/py4j-0.10.6-src.zip&quot;</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">from</span> pyspark <span class="keyword">import</span> SparkContext</span><br><span class="line">    <span class="keyword">from</span> pyspark.sql <span class="keyword">import</span> SparkSession</span><br><span class="line"></span><br><span class="line">    <span class="keyword">from</span> pyspark <span class="keyword">import</span> SparkConf</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;success&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">except</span> ImportError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;error importing spark modules&quot;</span>, e)</span><br><span class="line">    sys.exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#   SparkSession初始化</span></span><br><span class="line">spark = SparkSession \</span><br><span class="line">    .builder \</span><br><span class="line">    .master(<span class="string">&quot;yarn&quot;</span>) \</span><br><span class="line">    .appName(<span class="string">&quot;gps&quot;</span>) \</span><br><span class="line">    .config(<span class="string">&quot;spark.submit.deployMode&quot;</span>,<span class="string">&quot;client&quot;</span>) \</span><br><span class="line">    .config(<span class="string">&quot;num-executors&quot;</span>, <span class="number">5</span>) \</span><br><span class="line">    .config(<span class="string">&quot;executor-cores&quot;</span>, <span class="number">4</span>) \</span><br><span class="line">    .config(<span class="string">&quot;executor-memory&quot;</span>, <span class="string">&quot;2g&quot;</span>) \</span><br><span class="line">    .config(<span class="string">&quot;driver-memory&quot;</span>, <span class="string">&quot;1g&quot;</span>) \</span><br><span class="line">    .enableHiveSupport() \</span><br><span class="line">    .getOrCreate() </span><br><span class="line">sc = spark.sparkContext</span><br><span class="line"></span><br><span class="line"><span class="comment"># spark sql，得到dataframe</span></span><br><span class="line">df = spark.sql(<span class="string">&quot;SELECT * FROM tmp.czn_userlocation_filteredby_black&quot;</span>)</span><br><span class="line">df.printSchema()</span><br><span class="line">df.show(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 写到hdfs上，parquet格式</span></span><br><span class="line">df.write.parquet(<span class="string">&quot;/user/akulaku/czn_userlocation_filteredby_black.parquet&quot;</span>) </span><br></pre></td></tr></table></figure><p>这样我们就在hdfs上得到了一份parquet格式的文件。</p><h2 id="第三版"><a href="#第三版" class="headerlink" title="第三版"></a>第三版</h2><p>有时候我们可以在hive或者impala上建表，例如</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create table tmp.czn_usersensorlog_of_may as SELECT uid, apptime, value0, value1, value2 FROM ods.usersensorlog WHERE month = <span class="string">&quot;2018_05&quot;</span> </span><br></pre></td></tr></table></figure><p><code>show create table tmp.czn_usersensorlog_of_may</code><br><code>CREATE TABLE tmp.czn_usersensorlog_of_may (   uid BIGINT,   apptime BIGINT,   value0 FLOAT,   value1 FLOAT,   value2 FLOAT ) STORED AS TEXTFILE LOCATION &#39;hdfs://nameservice1/user/hive/warehouse/tmp.db/czn_usersensorlog_of_may&#39; </code></p><h2 id="第四版"><a href="#第四版" class="headerlink" title="第四版"></a>第四版</h2><p>有时候我们需要指定表的格式为parquet，这样有利于用pandas或者dask读取，那么可以如下设置，这里我们先建表再插入数据，</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">drop table <span class="keyword">if</span> exists tmp.czn_userlocation_tmp_test;</span><br><span class="line">CREATE TABLE tmp.czn_userlocation_tmp_test </span><br><span class="line">(   </span><br><span class="line">uid BIGINT,</span><br><span class="line">lat <span class="built_in">float</span>,</span><br><span class="line">lgt <span class="built_in">float</span>,</span><br><span class="line">apptime BIGINT,</span><br><span class="line">)</span><br><span class="line">STORED AS PARQUET</span><br><span class="line">TBLPROPERTIES (<span class="string">&#x27;parquet.compression&#x27;</span>=<span class="string">&#x27;SNAPPY&#x27;</span>);</span><br><span class="line"></span><br><span class="line">insert OVERWRITE TABLE tmp. czn_userlocation_tmp_test</span><br><span class="line">SELECT  uid, lat, lgt,  apptime </span><br><span class="line">from kafka_table.userlocation2 </span><br><span class="line">WHERE apptime between 1532156404000 and 1532156764000;</span><br></pre></td></tr></table></figure><p>得到了hdfs路径，这里我们可以直接用hdfs命令get</p><p>此时数据只是在hdfs上，我们要下载还需要将数据从hdfs 复制到跳板机，</p><p><code>hadoop fs -get /user/akulaku/czn_userlocation_filteredby_black.parquet chenzn/</code></p><p>再scp 之类的 复制到本地即可，不过相比scp，rsync更适合传输parquet，例如，可以压缩，断点续传等等，</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rsync -P -z -r -e ssh akulaku@cdh-master4:~/chenzn/czn_userlocation_filteredby_black.parquet ~</span><br></pre></td></tr></table></figure><p>parquet格式文件的读取可以使用dask，并选择‘pyarrow’引擎，可以顺利读取超过内存的数据，</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> dask.dataframe <span class="keyword">as</span> dd</span><br><span class="line">df = dd.read_parquet(file_path, engine=<span class="string">&#x27;pyarrow&#x27;</span>)</span><br></pre></td></tr></table></figure><h2 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h2><p>rsync其中参数如下，参考自<a href="https://kyup.com/tutorials/copy-files-rsync-ssh/">How to copy files with rsync over SSH - Tutorials For Kyup.com</a>：</p><ul><li>–delete - delete files that don’t exist on sender (system)</li><li>-v - verbose (-vv will provide more detailed information)</li><li>-e “ssh options” - specify the ssh as remote shell</li><li>-a - archive mode - it preserves permissions (owners, groups), times, symbolic links, and devices</li><li>-r - recurse into directories</li><li>-z - compress file data during transfer</li><li>–exclude ‘foldername’ – excludes the corresponding folder from transfer</li><li>-P – show progress during transfer</li></ul><p>🐶🐒</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;我们使用pyspark 读取Hive里的表格，存储到HDFS，再get到跳板机，再rsync到本地，再用dask读取为Dataframe。&lt;/p&gt;</summary>
    
    
    
    
    <category term="spark" scheme="https://frankchen.xyz/tags/spark/"/>
    
  </entry>
  
  <entry>
    <title>Mac 通过 socks5 代理 连接 ssh 的方法🏆</title>
    <link href="https://frankchen.xyz/2018/05/03/mac-ssh-through-socks5-proxy/"/>
    <id>https://frankchen.xyz/2018/05/03/mac-ssh-through-socks5-proxy/</id>
    <published>2018-05-03T09:08:10.000Z</published>
    <updated>2018-05-03T09:15:18.000Z</updated>
    
    <content type="html"><![CDATA[<p>经过一番痛苦的折腾，我才发现**socks,http代理等使用的是TCP或UDP协议, 而ping命令则是ICMP协议, 所以proxychains4对ping命令无效.**，最终又折腾过tsocks等和proxychains一样德行的以后，最终在万能的Stack Overflow找到<a href="https://serverfault.com/questions/315605/ssh-through-a-socks-proxy-client-openssh-os-x">答案</a>：即通过NetCat (nc)连接</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.ssh/config</span><br><span class="line"><span class="comment"># 添加以下内容</span></span><br><span class="line">Host 52.* <span class="comment"># 这里可以通配也可以指定IP</span></span><br><span class="line">    ProxyCommand nc -X 5 -x 127.0.0.1:1079 %h %p</span><br><span class="line">    <span class="comment"># &quot;5&quot; 是 SOCKS 5, &quot;1079&quot; 是本地socks端口</span></span><br></pre></td></tr></table></figure><p>之后直接使用<code>ssh</code>命令连接即可😎😂</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;经过一番痛苦的折腾，我才发现**socks,http代理等使用的是TCP或UDP协议, 而ping命令则是ICMP协议, 所以proxychains4对ping命令无效.**，最终又折腾过tsocks等和proxychains一样德行的以后，最终在万能的Stack Over</summary>
      
    
    
    
    
    <category term="Mac" scheme="https://frankchen.xyz/tags/Mac/"/>
    
  </entry>
  
  <entry>
    <title>moving averge 滑动平均</title>
    <link href="https://frankchen.xyz/2018/04/25/moving-averge/"/>
    <id>https://frankchen.xyz/2018/04/25/moving-averge/</id>
    <published>2018-04-25T14:58:46.000Z</published>
    <updated>2018-04-26T03:49:59.000Z</updated>
    
    <content type="html"><![CDATA[<p>moving averge 即滑动平均，时间序列处理中常见的方法，简单来说，就是对于一个给定数列，设定一个窗口值N，依次取第1项<del>第N项，第2项</del>第N+1项，第3项~第N+2项的平均值，以此类推。</p><span id="more"></span><p>数据来自<a href="http://blog.topspeedsnail.com/wp-content/uploads/2016/12/%E9%93%81%E8%B7%AF%E5%AE%A2%E8%BF%90%E9%87%8F.csv">铁路客运量.csv（2005-2016月度数据）</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> io</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pylab</span><br><span class="line">pylab.style.use(<span class="string">&#x27;bmh&#x27;</span>)</span><br><span class="line"><span class="keyword">from</span> pylab <span class="keyword">import</span> rcParams</span><br><span class="line">rcParams[<span class="string">&#x27;figure.figsize&#x27;</span>] = <span class="number">10</span>, <span class="number">8</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">moving_average</span>(<span class="params">l, N</span>):</span></span><br><span class="line"><span class="built_in">sum</span> = <span class="number">0</span></span><br><span class="line">result = <span class="built_in">list</span>( <span class="number">0</span> <span class="keyword">for</span> x <span class="keyword">in</span> l)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>( <span class="number">0</span>, N ):</span><br><span class="line">       <span class="comment"># 从左到右逐渐添加index在N之内的数字</span></span><br><span class="line"><span class="built_in">sum</span> = <span class="built_in">sum</span> + l[i]</span><br><span class="line">result[i] = <span class="built_in">sum</span> / (i+<span class="number">1</span>)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>( N, <span class="built_in">len</span>(l) ):</span><br><span class="line">       <span class="comment"># 加入最右边数字减去最左边数字</span></span><br><span class="line"><span class="built_in">sum</span> = <span class="built_in">sum</span> - l[i-N] + l[i]</span><br><span class="line">result[i] = <span class="built_in">sum</span> / N</span><br><span class="line"> </span><br><span class="line"><span class="keyword">return</span> result</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 使用效率更高的numpy</span></span><br><span class="line"><span class="comment"># http://stackoverflow.com/questions/13728392/moving-average-or-running-mean</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fast_moving_average</span>(<span class="params">x, N</span>):</span></span><br><span class="line"><span class="keyword">return</span> np.convolve(x, np.ones((N,))/N)[(N-<span class="number">1</span>):]</span><br><span class="line"> </span><br><span class="line">url = <span class="string">&#x27;铁路客运量.csv&#x27;</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">df = pd.read_csv(url)  <span class="comment"># python2使用StringIO.StringIO</span></span><br><span class="line"> </span><br><span class="line">data = np.array(df[<span class="string">&#x27;铁路客运量_当期值(万人)&#x27;</span>])</span><br><span class="line"> </span><br><span class="line">dic = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> [<span class="number">3</span>,<span class="number">5</span>,<span class="number">10</span>,<span class="number">20</span>]:</span><br><span class="line">    ma_data = moving_average(data, i)</span><br><span class="line">    dic[i] = ma_data</span><br><span class="line">ma_data_df = pd.DataFrame(dic)</span><br><span class="line"></span><br><span class="line">ma_data_df.plot()</span><br></pre></td></tr></table></figure><p>可以看到，趋势逐渐变得平滑，即对局部震荡不敏感。</p><p><img src="/images/download.png" alt="download"></p><p>使用numpy.convolve是一种更方便的方法，值得注意的是其有三种mode，分别是’full’（单个重叠也计算）, ‘same’（强制等长）, ‘valid’（完全重叠），</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fast_moving_average</span>(<span class="params">x, N, mode</span>):</span></span><br><span class="line"><span class="comment"># return np.convolve(x, np.ones((N,))/N, mode=&#x27;valid&#x27;)[(N-1):]</span></span><br><span class="line"><span class="keyword">return</span> np.convolve(x, np.ones((N,))/N, mode=mode)</span><br><span class="line">dic = &#123;&#125;</span><br><span class="line">modes = [<span class="string">&#x27;full&#x27;</span>, <span class="string">&#x27;same&#x27;</span>, <span class="string">&#x27;valid&#x27;</span>]</span><br><span class="line">i = <span class="number">10</span></span><br><span class="line"><span class="keyword">for</span> mode <span class="keyword">in</span> modes:</span><br><span class="line">    ma_data = fast_moving_average(data, i, mode)</span><br><span class="line">    pylab.plot(ma_data)</span><br><span class="line">pylab.legend(modes)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/images/download%20-1-.png" alt="download -1-"></p><p>参考自斗大熊的博客<a href="http://blog.topspeedsnail.com/archives/11022">MovingAverage-滑动平均 – WTF Daily Blog</a></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;moving averge 即滑动平均，时间序列处理中常见的方法，简单来说，就是对于一个给定数列，设定一个窗口值N，依次取第1项&lt;del&gt;第N项，第2项&lt;/del&gt;第N+1项，第3项~第N+2项的平均值，以此类推。&lt;/p&gt;</summary>
    
    
    
    
    <category term="time series" scheme="https://frankchen.xyz/tags/time-series/"/>
    
  </entry>
  
  <entry>
    <title>keras 中模型的保存及重用</title>
    <link href="https://frankchen.xyz/2018/04/19/keras-reuse-model/"/>
    <id>https://frankchen.xyz/2018/04/19/keras-reuse-model/</id>
    <published>2018-04-19T08:50:00.000Z</published>
    <updated>2018-04-25T11:57:18.000Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/images/15135840798621.jpg"><br>深度学习中如何保存最佳模型，如何重用已经保存的模型？本文主要介绍Keras 保存及重用模型的方法</p><span id="more"></span><h2 id="保存模型"><a href="#保存模型" class="headerlink" title="保存模型"></a>保存模型</h2><p>如下，我们预定义保存的<code>hdf5</code>文件名，再初始化<code>ModelCheckpoint</code>，将其加入Keras的callback里（即每个batch结束后做的事情），那么模型就会在每次batch结束后对比，保存最好的模型。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> keras.callbacks <span class="keyword">import</span> ModelCheckpoint</span><br><span class="line"></span><br><span class="line"><span class="comment"># create model</span></span><br><span class="line">model = Sequential()</span><br><span class="line">model.add(...)</span><br><span class="line">model.add(...)</span><br><span class="line">model.add(...)</span><br><span class="line"><span class="comment"># Compile model</span></span><br><span class="line">model.<span class="built_in">compile</span>(...)</span><br><span class="line"><span class="comment"># checkpoint</span></span><br><span class="line">filepath=<span class="string">&quot;weights-&#123;epoch:02d&#125;-&#123;val_acc:.2f&#125;.hdf5&quot;</span></span><br><span class="line">checkpoint = ModelCheckpoint(filepath, monitor=<span class="string">&#x27;val_acc&#x27;</span>, verbose=<span class="number">1</span>, save_best_only=<span class="literal">True</span>, mode=<span class="string">&#x27;max&#x27;</span>)</span><br><span class="line"><span class="comment"># Fit the model</span></span><br><span class="line">model.fit(X, Y, validation_split=<span class="number">0.33</span>, epochs=<span class="number">150</span>, batch_size=<span class="number">10</span>, callbacks=[checkpoint], verbose=<span class="number">0</span>)</span><br></pre></td></tr></table></figure><p>结束后，我们会得到如下的结果，</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">weights-53-0.76.hdf5</span><br><span class="line">weights-71-0.76.hdf5</span><br><span class="line">weights-77-0.78.hdf5</span><br><span class="line">weights-99-0.78.hdf5</span><br></pre></td></tr></table></figure><p>如果我们只想保存一个最好的模型，那么把保存文件名字固定为<code>filepath=&quot;weights.best.hdf5&quot;</code>即可。</p><h2 id="load模型"><a href="#load模型" class="headerlink" title="load模型"></a>load模型</h2><p>注意，之前保存的只是模型的weights，重新load需要再次定义模型结构再load weights并再次combine，例如</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> keras.callbacks <span class="keyword">import</span> ModelCheckpoint</span><br><span class="line"><span class="comment"># create model</span></span><br><span class="line">model = Sequential()</span><br><span class="line">model.add(...)</span><br><span class="line">model.add(...)</span><br><span class="line">model.add(...)</span><br><span class="line"><span class="comment"># load weights</span></span><br><span class="line">model.load_weights(<span class="string">&quot;weights.best.hdf5&quot;</span>)</span><br><span class="line"><span class="comment"># Compile model </span></span><br><span class="line">model.<span class="built_in">compile</span>(...)</span><br><span class="line"><span class="comment"># estimate accuracy </span></span><br><span class="line">scores = model.evaluate(X, Y, verbose=<span class="number">0</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;&#123;&#125;: &#123;:.2%&#125;&#x27;</span>.<span class="built_in">format</span>(model.metrics_names[<span class="number">1</span>], scores[<span class="number">1</span>]))</span><br></pre></td></tr></table></figure><p>如果之前选择了连模型结构也一起保存（即在<code>ModelCheckpoint</code>中选择<code> save_weights_only=False</code>），那么load就很简单，</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> keras.callbacks <span class="keyword">import</span> ModelCheckpoint</span><br><span class="line"><span class="keyword">from</span> keras.models <span class="keyword">import</span> load_model</span><br><span class="line"></span><br><span class="line"><span class="comment"># create model</span></span><br><span class="line">model = Sequential()</span><br><span class="line">model.add(...)</span><br><span class="line">model.add(...)</span><br><span class="line">model.add(...)</span><br><span class="line"><span class="comment"># Compile model</span></span><br><span class="line">model.<span class="built_in">compile</span>(...)</span><br><span class="line"><span class="comment"># checkpoint</span></span><br><span class="line">filepath=<span class="string">&quot;weights-best.hdf5&quot;</span></span><br><span class="line">checkpoint = ModelCheckpoint(filepath, monitor=<span class="string">&#x27;val_acc&#x27;</span>, verbose=<span class="number">1</span>, save_best_only=<span class="literal">True</span>, mode=<span class="string">&#x27;max&#x27;</span>, save_weights_only=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Fit the model</span></span><br><span class="line">model.fit(X, Y, validation_split=<span class="number">0.33</span>, epochs=<span class="number">150</span>, batch_size=<span class="number">10</span>, callbacks=[checkpoint], verbose=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Load the model</span></span><br><span class="line">model= load_model(filepath)</span><br><span class="line">scores=model.evaluate(X, Y,verbose=<span class="number">0</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;&#123;&#125;: &#123;:.2%&#125;&#x27;</span>.<span class="built_in">format</span>(model.metrics_names[<span class="number">1</span>], scores[<span class="number">1</span>]))</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;img src=&quot;/images/15135840798621.jpg&quot;&gt;&lt;br&gt;深度学习中如何保存最佳模型，如何重用已经保存的模型？本文主要介绍Keras 保存及重用模型的方法&lt;/p&gt;</summary>
    
    
    
    
    <category term="Keras" scheme="https://frankchen.xyz/tags/Keras/"/>
    
  </entry>
  
  <entry>
    <title>理解一维卷积</title>
    <link href="https://frankchen.xyz/2018/04/17/conv1d-in-keras/"/>
    <id>https://frankchen.xyz/2018/04/17/conv1d-in-keras/</id>
    <published>2018-04-17T07:46:36.000Z</published>
    <updated>2018-04-19T08:50:30.000Z</updated>
    
    <content type="html"><![CDATA[<p>理解一维卷积</p><span id="more"></span><p>下面是一个利用CNN进行NLP中的情感分类的例子，<br><img src="/images/15240224514694.png"></p><p>上图中，输入为表示为词表为d=5，长度为7的矩阵的句子，1D卷积核为长度分别为(2,3,4)的各两个，经过卷积并激活函数后，各自产生了(4x1, 5x1, 6x1)的各两个feature map，每个feature map经过一次1D max pooling后（即取每个feature map的最大值）再concatenate为一个6x1的1D向量，经过一个全连接层再softmax激活即可进行情感分类预测。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;理解一维卷积&lt;/p&gt;</summary>
    
    
    
    
    <category term="Deep Learning" scheme="https://frankchen.xyz/tags/Deep-Learning/"/>
    
  </entry>
  
  <entry>
    <title>处理大数据集的建议</title>
    <link href="https://frankchen.xyz/2018/04/10/handle-big-datasets/"/>
    <id>https://frankchen.xyz/2018/04/10/handle-big-datasets/</id>
    <published>2018-04-10T07:07:34.000Z</published>
    <updated>2018-04-10T08:15:51.000Z</updated>
    
    <content type="html"><![CDATA[<p>最近的一些比赛如<a href="https://www.kaggle.com/c/talkingdata-adtracking-fraud-detection">TalkingData AdTracking Fraud Detection Challenge | Kaggle</a>提供了很大的数据集，一般来说，只有16G的内存的“小”电脑都无法直接处理这种数据集了，本文收集了一些关于处理这种数据的建议，供大家参考。</p><span id="more"></span><h2 id="1-及时删除无用变量并垃圾回收"><a href="#1-及时删除无用变量并垃圾回收" class="headerlink" title="1.及时删除无用变量并垃圾回收"></a>1.及时删除无用变量并垃圾回收</h2><p>通常我们在特征工程中会涉及大量的转换操作，产生很多的中间变量等，除了使用<code>del</code>以外，使用<code>gc.collect()</code>也是个不错的选择。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">temp = pd.read_csv(<span class="string">&#x27;../input/train_sample.csv&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#do something to the file</span></span><br><span class="line">temp[<span class="string">&#x27;os&#x27;</span>] = temp[<span class="string">&#x27;os&#x27;</span>].astype(<span class="string">&#x27;str&#x27;</span>)</span><br><span class="line"><span class="comment">#delete when no longer needed</span></span><br><span class="line"><span class="keyword">del</span> temp</span><br><span class="line"><span class="comment">#collect residual garbage</span></span><br><span class="line">gc.collect()</span><br></pre></td></tr></table></figure><h2 id="2-预定义数据类型"><a href="#2-预定义数据类型" class="headerlink" title="2.预定义数据类型"></a>2.预定义数据类型</h2><p>pandas一般会自己推断数据类型，不过倾向于使用耗费空间大的，如下面例子所示，预定义数据类型节省了超过一半的空间。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">dtypes = &#123;</span><br><span class="line">        <span class="string">&#x27;ip&#x27;</span>            : <span class="string">&#x27;uint32&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;app&#x27;</span>           : <span class="string">&#x27;uint16&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;device&#x27;</span>        : <span class="string">&#x27;uint16&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;os&#x27;</span>            : <span class="string">&#x27;uint16&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;channel&#x27;</span>       : <span class="string">&#x27;uint16&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;is_attributed&#x27;</span> : <span class="string">&#x27;uint8&#x27;</span>,</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">dtypes2 = &#123;</span><br><span class="line">        <span class="string">&#x27;ip&#x27;</span>            : <span class="string">&#x27;int32&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;app&#x27;</span>           : <span class="string">&#x27;int16&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;device&#x27;</span>        : <span class="string">&#x27;int16&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;os&#x27;</span>            : <span class="string">&#x27;int16&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;channel&#x27;</span>       : <span class="string">&#x27;int16&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;is_attributed&#x27;</span> : <span class="string">&#x27;int8&#x27;</span>,</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">train = pd.read_csv(train_sample_file,parse_dates=[<span class="string">&#x27;click_time&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment">#check datatypes:</span></span><br><span class="line">train.info()</span><br><span class="line"></span><br><span class="line">train = pd.read_csv(train_sample_file,dtype=dtypes,parse_dates=[<span class="string">&#x27;click_time&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment">#check datatypes:</span></span><br><span class="line">train.info()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">train = pd.read_csv(train_sample_file,dtype=dtypes2,parse_dates=[<span class="string">&#x27;click_time&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment">#check datatypes:</span></span><br><span class="line">train.info()</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">&lt;class &#x27;pandas.core.frame.DataFrame&#x27;&gt;</span></span><br><span class="line"><span class="string">RangeIndex: 100000 entries, 0 to 99999</span></span><br><span class="line"><span class="string">Data columns (total 8 columns):</span></span><br><span class="line"><span class="string">ip                 100000 non-null int64</span></span><br><span class="line"><span class="string">app                100000 non-null int64</span></span><br><span class="line"><span class="string">device             100000 non-null int64</span></span><br><span class="line"><span class="string">os                 100000 non-null int64</span></span><br><span class="line"><span class="string">channel            100000 non-null int64</span></span><br><span class="line"><span class="string">click_time         100000 non-null datetime64[ns]</span></span><br><span class="line"><span class="string">attributed_time    227 non-null object</span></span><br><span class="line"><span class="string">is_attributed      100000 non-null int64</span></span><br><span class="line"><span class="string">dtypes: datetime64[ns](1), int64(6), object(1)</span></span><br><span class="line"><span class="string">memory usage: 6.1+ MB</span></span><br><span class="line"><span class="string">&lt;class &#x27;pandas.core.frame.DataFrame&#x27;&gt;</span></span><br><span class="line"><span class="string">RangeIndex: 100000 entries, 0 to 99999</span></span><br><span class="line"><span class="string">Data columns (total 8 columns):</span></span><br><span class="line"><span class="string">ip                 100000 non-null uint32</span></span><br><span class="line"><span class="string">app                100000 non-null uint16</span></span><br><span class="line"><span class="string">device             100000 non-null uint16</span></span><br><span class="line"><span class="string">os                 100000 non-null uint16</span></span><br><span class="line"><span class="string">channel            100000 non-null uint16</span></span><br><span class="line"><span class="string">click_time         100000 non-null datetime64[ns]</span></span><br><span class="line"><span class="string">attributed_time    227 non-null object</span></span><br><span class="line"><span class="string">is_attributed      100000 non-null uint8</span></span><br><span class="line"><span class="string">dtypes: datetime64[ns](1), object(1), uint16(4), uint32(1), uint8(1)</span></span><br><span class="line"><span class="string">memory usage: 2.8+ MB</span></span><br><span class="line"><span class="string">&lt;class &#x27;pandas.core.frame.DataFrame&#x27;&gt;</span></span><br><span class="line"><span class="string">RangeIndex: 100000 entries, 0 to 99999</span></span><br><span class="line"><span class="string">Data columns (total 8 columns):</span></span><br><span class="line"><span class="string">ip                 100000 non-null int32</span></span><br><span class="line"><span class="string">app                100000 non-null int16</span></span><br><span class="line"><span class="string">device             100000 non-null int16</span></span><br><span class="line"><span class="string">os                 100000 non-null int16</span></span><br><span class="line"><span class="string">channel            100000 non-null int16</span></span><br><span class="line"><span class="string">click_time         100000 non-null datetime64[ns]</span></span><br><span class="line"><span class="string">attributed_time    227 non-null object</span></span><br><span class="line"><span class="string">is_attributed      100000 non-null int8</span></span><br><span class="line"><span class="string">dtypes: datetime64[ns](1), int16(4), int32(1), int8(1), object(1)</span></span><br><span class="line"><span class="string">memory usage: 2.8+ MB</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="3-只使用csv文件内的指定行"><a href="#3-只使用csv文件内的指定行" class="headerlink" title="3.只使用csv文件内的指定行"></a>3.只使用csv文件内的指定行</h2><h3 id="a-指定行数"><a href="#a-指定行数" class="headerlink" title="a) 指定行数"></a>a) 指定行数</h3><p>直接使用nrows指定</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">train = pd.read_csv(<span class="string">&#x27;../input/train.csv&#x27;</span>, nrows=<span class="number">1e5</span>, dtype=dtypes)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="b-跳过行数"><a href="#b-跳过行数" class="headerlink" title="b) 跳过行数"></a>b) 跳过行数</h3><p>比如我们跳过前500w取100w下面保留了head，</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">train = pd.read_csv(<span class="string">&#x27;../input/train.csv&#x27;</span>, skiprows=<span class="built_in">range</span>(<span class="number">1</span>, <span class="number">5000000</span>), nrows=<span class="number">1000000</span>, dtype=dtypes)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="c-sampling"><a href="#c-sampling" class="headerlink" title="c) sampling"></a>c) sampling</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;# Line count:&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> file <span class="keyword">in</span> [<span class="string">&#x27;train.csv&#x27;</span>, <span class="string">&#x27;test.csv&#x27;</span>, <span class="string">&#x27;train_sample.csv&#x27;</span>]:</span><br><span class="line">    lines = subprocess.run([<span class="string">&#x27;wc&#x27;</span>, <span class="string">&#x27;-l&#x27;</span>, <span class="string">&#x27;../input/&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(file)], stdout=subprocess.PIPE).stdout.decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(lines, end=<span class="string">&#x27;&#x27;</span>, flush=<span class="literal">True</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string"># Line count:</span></span><br><span class="line"><span class="string">184903891 ../input/train.csv</span></span><br><span class="line"><span class="string">18790470 ../input/test.csv</span></span><br><span class="line"><span class="string">100001 ../input/train_sample.csv</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><p>train一共有<code>lines=184903891</code> 行，那么假设我们需要采样出100w行，那么我们需要跳过<code>lines - 1 - 1000000</code>行，即</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#generate list of lines to skip</span></span><br><span class="line">skiplines = np.random.choice(np.arange(<span class="number">1</span>, lines), size=lines-<span class="number">1</span>-<span class="number">1000000</span>, replace=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#sort the list</span></span><br><span class="line">skiplines=np.sort(skiplines)</span><br><span class="line"><span class="comment">#check our list</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;lines to skip:&#x27;</span>, <span class="built_in">len</span>(skiplines))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;remaining lines in sample:&#x27;</span>, lines-<span class="built_in">len</span>(skiplines), <span class="string">&#x27;(remember that it includes the heading!)&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">###################SANITY CHECK###################</span></span><br><span class="line"><span class="comment">#find lines that weren&#x27;t skipped by checking difference between each consecutive line</span></span><br><span class="line"><span class="comment">#how many out of first 100000 will be imported into the csv?</span></span><br><span class="line">diff = skiplines[<span class="number">1</span>:<span class="number">100000</span>]-skiplines[<span class="number">2</span>:<span class="number">100001</span>]</span><br><span class="line">remain = <span class="built_in">sum</span>(diff!=-<span class="number">1</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Ratio of lines from first 100000 lines:&#x27;</span>,  <span class="string">&#x27;&#123;0:.5f&#125;&#x27;</span>.<span class="built_in">format</span>(remain/<span class="number">100000</span>) ) </span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Ratio imported from all lines:&#x27;</span>, <span class="string">&#x27;&#123;0:.5f&#125;&#x27;</span>.<span class="built_in">format</span>((lines-<span class="built_in">len</span>(skiplines))/lines) )</span><br><span class="line">train = pd.read_csv(<span class="string">&#x27;../input/train.csv&#x27;</span>, skiprows=skiplines, dtype=dtypes)</span><br><span class="line">train.head()</span><br><span class="line"><span class="keyword">del</span> skiplines</span><br><span class="line">gc.collect()</span><br></pre></td></tr></table></figure><h2 id="4-使用pandas-的生成器，用chunk处理"><a href="#4-使用pandas-的生成器，用chunk处理" class="headerlink" title="4.使用pandas 的生成器，用chunk处理"></a>4.使用pandas 的生成器，用chunk处理</h2><p>这里我们使用np.where过滤掉‘is_attributed’为0的部分（例如<code>[xv if c else yv for (c,xv,yv) in zip(condition,x,y)] </code>）</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#set up an empty dataframe</span></span><br><span class="line">df_converted = pd.DataFrame()</span><br><span class="line"></span><br><span class="line"><span class="comment">#we are going to work with chunks of size 1 million rows</span></span><br><span class="line">chunksize = <span class="number">10</span> ** <span class="number">6</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#in each chunk, filter for values that have &#x27;is_attributed&#x27;==1, and merge these values into one dataframe</span></span><br><span class="line"><span class="keyword">for</span> chunk <span class="keyword">in</span> pd.read_csv(<span class="string">&#x27;../input/train.csv&#x27;</span>, chunksize=chunksize, dtype=dtypes):</span><br><span class="line">    filtered = (chunk[(np.where(chunk[<span class="string">&#x27;is_attributed&#x27;</span>]==<span class="number">1</span>, <span class="literal">True</span>, <span class="literal">False</span>))])</span><br><span class="line">    df_converted = pd.concat([df_converted, filtered], ignore_index=<span class="literal">True</span>, )</span><br></pre></td></tr></table></figure><h2 id="5-只载入若干列"><a href="#5-只载入若干列" class="headerlink" title="5.只载入若干列"></a>5.只载入若干列</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#wanted columns</span></span><br><span class="line">columns = [<span class="string">&#x27;ip&#x27;</span>, <span class="string">&#x27;click_time&#x27;</span>, <span class="string">&#x27;is_attributed&#x27;</span>]</span><br><span class="line">dtypes = &#123;</span><br><span class="line">        <span class="string">&#x27;ip&#x27;</span>            : <span class="string">&#x27;uint32&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;is_attributed&#x27;</span> : <span class="string">&#x27;uint8&#x27;</span>,</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">ips_df = pd.read_csv(<span class="string">&#x27;../input/train.csv&#x27;</span>, usecols=columns, dtype=dtypes)</span><br><span class="line"><span class="built_in">print</span>(ips_df.info())</span><br><span class="line">ips_df.head()</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">&lt;class &#x27;pandas.core.frame.DataFrame&#x27;&gt;</span></span><br><span class="line"><span class="string">RangeIndex: 184903890 entries, 0 to 184903889</span></span><br><span class="line"><span class="string">Data columns (total 3 columns):</span></span><br><span class="line"><span class="string">ip               uint32</span></span><br><span class="line"><span class="string">click_time       object</span></span><br><span class="line"><span class="string">is_attributed    uint8</span></span><br><span class="line"><span class="string">dtypes: object(1), uint32(1), uint8(1)</span></span><br><span class="line"><span class="string">memory usage: 2.2+ GB</span></span><br><span class="line"><span class="string">None&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="6-结合多种方法创意性的处理数据"><a href="#6-结合多种方法创意性的处理数据" class="headerlink" title="6.结合多种方法创意性的处理数据"></a>6.结合多种方法创意性的处理数据</h2><p>例如无法使用整个数据来groupby那么可以分块来做，</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">size=<span class="number">100000</span></span><br><span class="line">all_rows = <span class="built_in">len</span>(ips_df)</span><br><span class="line">num_parts = all_rows//size</span><br><span class="line"></span><br><span class="line"><span class="comment">#generate the first batch</span></span><br><span class="line">ip_sums = ips_df[<span class="number">0</span>:size][[<span class="string">&#x27;ip&#x27;</span>, <span class="string">&#x27;is_attributed&#x27;</span>]].groupby(<span class="string">&#x27;ip&#x27;</span>, as_index=<span class="literal">False</span>).<span class="built_in">sum</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">#add remaining batches</span></span><br><span class="line"><span class="keyword">for</span> p <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,num_parts):</span><br><span class="line">    start = p*size</span><br><span class="line">    end = p*size + size</span><br><span class="line">    <span class="keyword">if</span> end &lt; all_rows:</span><br><span class="line">        group = ips_df[start:end][[<span class="string">&#x27;ip&#x27;</span>, <span class="string">&#x27;is_attributed&#x27;</span>]].groupby(<span class="string">&#x27;ip&#x27;</span>, as_index=<span class="literal">False</span>).<span class="built_in">sum</span>()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        group = ips_df[start:][[<span class="string">&#x27;ip&#x27;</span>, <span class="string">&#x27;is_attributed&#x27;</span>]].groupby(<span class="string">&#x27;ip&#x27;</span>, as_index=<span class="literal">False</span>).<span class="built_in">sum</span>()</span><br><span class="line">    ip_sums = ip_sums.merge(group, on=<span class="string">&#x27;ip&#x27;</span>, how=<span class="string">&#x27;outer&#x27;</span>)</span><br><span class="line">    ip_sums.columns = [<span class="string">&#x27;ip&#x27;</span>, <span class="string">&#x27;sum1&#x27;</span>,<span class="string">&#x27;sum2&#x27;</span>]</span><br><span class="line">    ip_sums[<span class="string">&#x27;conversions_per_ip&#x27;</span>] = np.nansum((ip_sums[<span class="string">&#x27;sum1&#x27;</span>], ip_sums[<span class="string">&#x27;sum2&#x27;</span>]), axis = <span class="number">0</span>)</span><br><span class="line">    ip_sums.drop(columns=[<span class="string">&#x27;sum1&#x27;</span>, <span class="string">&#x27;sum2&#x27;</span>], axis = <span class="number">0</span>, inplace=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><h2 id="7-使用dask代替pandas"><a href="#7-使用dask代替pandas" class="headerlink" title="7.使用dask代替pandas"></a>7.使用dask代替pandas</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">import dask</span><br><span class="line">import dask.dataframe as dd</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;最近的一些比赛如&lt;a href=&quot;https://www.kaggle.com/c/talkingdata-adtracking-fraud-detection&quot;&gt;TalkingData AdTracking Fraud Detection Challenge | Kaggle&lt;/a&gt;提供了很大的数据集，一般来说，只有16G的内存的“小”电脑都无法直接处理这种数据集了，本文收集了一些关于处理这种数据的建议，供大家参考。&lt;/p&gt;</summary>
    
    
    
    
    <category term="python" scheme="https://frankchen.xyz/tags/python/"/>
    
    <category term="Data Science" scheme="https://frankchen.xyz/tags/Data-Science/"/>
    
    <category term="Kaggle" scheme="https://frankchen.xyz/tags/Kaggle/"/>
    
  </entry>
  
  <entry>
    <title>机器学习之 sklearn中的pipeline</title>
    <link href="https://frankchen.xyz/2018/04/08/pipeline-in-machine-learning/"/>
    <id>https://frankchen.xyz/2018/04/08/pipeline-in-machine-learning/</id>
    <published>2018-04-08T08:13:42.000Z</published>
    <updated>2018-04-11T07:25:07.000Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/images/15231874915799.jpg"></p><span id="more"></span><p>如图所示，利用pipeline我们可以方便的减少代码量同时让机器学习的流程变得直观，<br><img src="/images/15231783974167.jpg"></p><p>例如我们需要做如下操作，容易看出，训练测试集重复了代码，</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">vect = CountVectorizer()</span><br><span class="line">tfidf = TfidfTransformer()</span><br><span class="line">clf = SGDClassifier()</span><br><span class="line"></span><br><span class="line">vX = vect.fit_transform(Xtrain)</span><br><span class="line">tfidfX = tfidf.fit_transform(vX)</span><br><span class="line">predicted = clf.fit_predict(tfidfX)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Now evaluate all steps on test set</span></span><br><span class="line">vX = vect.fit_transform(Xtest)</span><br><span class="line">tfidfX = tfidf.fit_transform(vX)</span><br><span class="line">predicted = clf.fit_predict(tfidfX)</span><br></pre></td></tr></table></figure><p>利用pipeline，上面代码可以抽象为，</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">pipeline = Pipeline([</span><br><span class="line">    (<span class="string">&#x27;vect&#x27;</span>, CountVectorizer()),</span><br><span class="line">    (<span class="string">&#x27;tfidf&#x27;</span>, TfidfTransformer()),</span><br><span class="line">    (<span class="string">&#x27;clf&#x27;</span>, SGDClassifier()),</span><br><span class="line">])</span><br><span class="line">predicted = pipeline.fit(Xtrain).predict(Xtrain)</span><br><span class="line"><span class="comment"># Now evaluate all steps on test set</span></span><br><span class="line">predicted = pipeline.predict(Xtest)</span><br></pre></td></tr></table></figure><p>注意，pipeline最后一步如果有predict()方法我们才可以对pipeline使用fit_predict()，同理，最后一步如果有transform()方法我们才可以对pipeline使用fit_transform()方法。</p><h2 id="使用pipeline做cross-validation"><a href="#使用pipeline做cross-validation" class="headerlink" title="使用pipeline做cross validation"></a>使用pipeline做cross validation</h2><p>看如下案例，即先对输入手写数字的数据进行PCA降维，再通过逻辑回归预测标签。其中我们通过pipeline对<br>PCA的降维维数n_components和逻辑回归的正则项C大小做交叉验证，主要步骤有：</p><ol><li>依次实例化各成分对象如<code>pca = decomposition.PCA()</code></li><li>以(name, object)的tuble为元素组装pipeline如<code>Pipeline(steps=[(&#39;pca&#39;, pca), (&#39;logistic&#39;, logistic)])</code></li><li>初始化CV参数如<code>n_components = [20, 40, 64]</code></li><li>实例化CV对象如<code>estimator = GridSearchCV(pipe, dict(pca__n_components=n_components, logistic__C=Cs))</code>，其中注意参数的传递方式，即key为pipeline元素名+函数参数</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">from</span> sklearn <span class="keyword">import</span> linear_model, decomposition, datasets</span><br><span class="line"><span class="keyword">from</span> sklearn.pipeline <span class="keyword">import</span> Pipeline</span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> GridSearchCV</span><br><span class="line">logistic = linear_model.LogisticRegression()</span><br><span class="line"></span><br><span class="line">pca = decomposition.PCA()</span><br><span class="line">pipe = Pipeline(steps=[(<span class="string">&#x27;pca&#x27;</span>, pca), (<span class="string">&#x27;logistic&#x27;</span>, logistic)])</span><br><span class="line"></span><br><span class="line">digits = datasets.load_digits()</span><br><span class="line">X_digits = digits.data</span><br><span class="line">y_digits = digits.target</span><br><span class="line"></span><br><span class="line"><span class="comment"># Prediction</span></span><br><span class="line">n_components = [<span class="number">20</span>, <span class="number">40</span>, <span class="number">64</span>]</span><br><span class="line">Cs = np.logspace(-<span class="number">4</span>, <span class="number">4</span>, <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">pca.fit(X_digits)</span><br><span class="line">estimator = GridSearchCV(pipe,</span><br><span class="line">                         <span class="built_in">dict</span>(pca__n_components=n_components, logistic__C=Cs))</span><br><span class="line">estimator.fit(X_digits, y_digits)</span><br><span class="line"></span><br><span class="line">plt.figure(<span class="number">1</span>, figsize=(<span class="number">4</span>, <span class="number">3</span>))</span><br><span class="line">plt.clf()</span><br><span class="line">plt.axes([<span class="number">.2</span>, <span class="number">.2</span>, <span class="number">.7</span>, <span class="number">.7</span>])</span><br><span class="line">plt.plot(pca.explained_variance_, linewidth=<span class="number">2</span>)</span><br><span class="line">plt.axis(<span class="string">&#x27;tight&#x27;</span>)</span><br><span class="line">plt.xlabel(<span class="string">&#x27;n_components&#x27;</span>)</span><br><span class="line">plt.ylabel(<span class="string">&#x27;explained_variance_&#x27;</span>)</span><br><span class="line">plt.axvline(</span><br><span class="line">    estimator.best_estimator_.named_steps[<span class="string">&#x27;pca&#x27;</span>].n_components,</span><br><span class="line">    linestyle=<span class="string">&#x27;:&#x27;</span>,</span><br><span class="line">    label=<span class="string">&#x27;n_components chosen&#x27;</span>)</span><br><span class="line">plt.legend(prop=<span class="built_in">dict</span>(size=<span class="number">12</span>))</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><h2 id="自定义transformer"><a href="#自定义transformer" class="headerlink" title="自定义transformer"></a>自定义transformer</h2><p>我们可以如下自定义transformer（来自<a href="http://michelleful.github.io/code-blog/2015/06/20/pipelines/">Using Pipelines and FeatureUnions in scikit-learn - Michelle Fullwood</a>）</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.base <span class="keyword">import</span> BaseEstimator, TransformerMixin</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SampleExtractor</span>(<span class="params">BaseEstimator, TransformerMixin</span>):</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, <span class="built_in">vars</span></span>):</span></span><br><span class="line">        self.<span class="built_in">vars</span> = <span class="built_in">vars</span>  <span class="comment"># e.g. pass in a column name to extract</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">transform</span>(<span class="params">self, X, y=<span class="literal">None</span></span>):</span></span><br><span class="line">        <span class="keyword">return</span> do_something_to(X, self.<span class="built_in">vars</span>)  <span class="comment"># where the actual feature extraction happens</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">fit</span>(<span class="params">self, X, y=<span class="literal">None</span></span>):</span></span><br><span class="line">        <span class="keyword">return</span> self  <span class="comment"># generally does nothing</span></span><br></pre></td></tr></table></figure><p>另外，我们也可以对每个feature单独处理，例如下面的这个比较大的流水线（来自<a href="http://zacstewart.com/2014/08/05/pipelines-of-featureunions-of-pipelines.html">Using scikit-learn Pipelines and FeatureUnions | zacstewart.com</a>），我们可以发现作者的pipeline中，首先是一个叫做<code>features</code>的FeatureUnion，其中，每个特征分别以一个pipeline来处理，这个pipeline首先是一个<code>ColumnExtractor</code>提取出这个特征，后续进行一系列处理转换，最终这些pipeline组合为特征组合，再喂给一系列<code>ModelTransformer</code>包装的模型来predict，最终使用<code>KNeighborsRegressor</code>预测（相当于两层stacking）。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">pipeline = Pipeline([</span><br><span class="line">    (<span class="string">&#x27;features&#x27;</span>, FeatureUnion([</span><br><span class="line">        (<span class="string">&#x27;continuous&#x27;</span>, Pipeline([</span><br><span class="line">            (<span class="string">&#x27;extract&#x27;</span>, ColumnExtractor(CONTINUOUS_FIELDS)),</span><br><span class="line">            (<span class="string">&#x27;scale&#x27;</span>, Normalizer())</span><br><span class="line">        ])),</span><br><span class="line">        (<span class="string">&#x27;factors&#x27;</span>, Pipeline([</span><br><span class="line">            (<span class="string">&#x27;extract&#x27;</span>, ColumnExtractor(FACTOR_FIELDS)),</span><br><span class="line">            (<span class="string">&#x27;one_hot&#x27;</span>, OneHotEncoder(n_values=<span class="number">5</span>)),</span><br><span class="line">            (<span class="string">&#x27;to_dense&#x27;</span>, DenseTransformer())</span><br><span class="line">        ])),</span><br><span class="line">        (<span class="string">&#x27;weekday&#x27;</span>, Pipeline([</span><br><span class="line">            (<span class="string">&#x27;extract&#x27;</span>, DayOfWeekTransformer()),</span><br><span class="line">            (<span class="string">&#x27;one_hot&#x27;</span>, OneHotEncoder()),</span><br><span class="line">            (<span class="string">&#x27;to_dense&#x27;</span>, DenseTransformer())</span><br><span class="line">        ])),</span><br><span class="line">        (<span class="string">&#x27;hour_of_day&#x27;</span>, HourOfDayTransformer()),</span><br><span class="line">        (<span class="string">&#x27;month&#x27;</span>, Pipeline([</span><br><span class="line">            (<span class="string">&#x27;extract&#x27;</span>, ColumnExtractor([<span class="string">&#x27;datetime&#x27;</span>])),</span><br><span class="line">            (<span class="string">&#x27;to_month&#x27;</span>, DateTransformer()),</span><br><span class="line">            (<span class="string">&#x27;one_hot&#x27;</span>, OneHotEncoder()),</span><br><span class="line">            (<span class="string">&#x27;to_dense&#x27;</span>, DenseTransformer())</span><br><span class="line">        ])),</span><br><span class="line">        (<span class="string">&#x27;growth&#x27;</span>, Pipeline([</span><br><span class="line">            (<span class="string">&#x27;datetime&#x27;</span>, ColumnExtractor([<span class="string">&#x27;datetime&#x27;</span>])),</span><br><span class="line">            (<span class="string">&#x27;to_numeric&#x27;</span>, MatrixConversion(<span class="built_in">int</span>)),</span><br><span class="line">            (<span class="string">&#x27;regression&#x27;</span>, ModelTransformer(LinearRegression()))</span><br><span class="line">        ]))</span><br><span class="line">    ])),</span><br><span class="line">    (<span class="string">&#x27;estimators&#x27;</span>, FeatureUnion([</span><br><span class="line">        (<span class="string">&#x27;knn&#x27;</span>, ModelTransformer(KNeighborsRegressor(n_neighbors=<span class="number">5</span>))),</span><br><span class="line">        (<span class="string">&#x27;gbr&#x27;</span>, ModelTransformer(GradientBoostingRegressor())),</span><br><span class="line">        (<span class="string">&#x27;dtr&#x27;</span>, ModelTransformer(DecisionTreeRegressor())),</span><br><span class="line">        (<span class="string">&#x27;etr&#x27;</span>, ModelTransformer(ExtraTreesRegressor())),</span><br><span class="line">        (<span class="string">&#x27;rfr&#x27;</span>, ModelTransformer(RandomForestRegressor())),</span><br><span class="line">        (<span class="string">&#x27;par&#x27;</span>, ModelTransformer(PassiveAggressiveRegressor())),</span><br><span class="line">        (<span class="string">&#x27;en&#x27;</span>, ModelTransformer(ElasticNet())),</span><br><span class="line">        (<span class="string">&#x27;cluster&#x27;</span>, ModelTransformer(KMeans(n_clusters=<span class="number">2</span>)))</span><br><span class="line">    ])),</span><br><span class="line">    (<span class="string">&#x27;estimator&#x27;</span>, KNeighborsRegressor())</span><br><span class="line">])</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HourOfDayTransformer</span>(<span class="params">TransformerMixin</span>):</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">transform</span>(<span class="params">self, X, **transform_params</span>):</span></span><br><span class="line">        hours = DataFrame(X[<span class="string">&#x27;datetime&#x27;</span>].apply(<span class="keyword">lambda</span> x: x.hour))</span><br><span class="line">        <span class="keyword">return</span> hours</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">fit</span>(<span class="params">self, X, y=<span class="literal">None</span>, **fit_params</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ModelTransformer</span>(<span class="params">TransformerMixin</span>):</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, model</span>):</span></span><br><span class="line">        self.model = model</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">fit</span>(<span class="params">self, *args, **kwargs</span>):</span></span><br><span class="line">        self.model.fit(*args, **kwargs)</span><br><span class="line">        <span class="keyword">return</span> self</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">transform</span>(<span class="params">self, X, **transform_params</span>):</span></span><br><span class="line">        <span class="keyword">return</span> DataFrame(self.model.predict(X))</span><br></pre></td></tr></table></figure><h2 id="FeatureUnion"><a href="#FeatureUnion" class="headerlink" title="FeatureUnion"></a>FeatureUnion</h2><p><a href="http://scikit-learn.org/stable/modules/generated/sklearn.pipeline.FeatureUnion.html">sklearn.pipeline.FeatureUnion — scikit-learn 0.19.1 documentation</a> 和pipeline的序列执行不同，FeatureUnion指的是并行地应用许多transformer在input上，再将结果合并，所以自然地适合特征工程中的增加特征，而FeatureUnion与pipeline组合可以方便的完成许多复杂的操作，例如如下的例子，</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">pipeline = Pipeline([</span><br><span class="line">  (<span class="string">&#x27;extract_essays&#x27;</span>, EssayExractor()),</span><br><span class="line">  (<span class="string">&#x27;features&#x27;</span>, FeatureUnion([</span><br><span class="line">    (<span class="string">&#x27;ngram_tf_idf&#x27;</span>, Pipeline([</span><br><span class="line">      (<span class="string">&#x27;counts&#x27;</span>, CountVectorizer()),</span><br><span class="line">      (<span class="string">&#x27;tf_idf&#x27;</span>, TfidfTransformer())</span><br><span class="line">    ])),</span><br><span class="line">    (<span class="string">&#x27;essay_length&#x27;</span>, LengthTransformer()),</span><br><span class="line">    (<span class="string">&#x27;misspellings&#x27;</span>, MispellingCountTransformer())</span><br><span class="line">  ])),</span><br><span class="line">  (<span class="string">&#x27;classifier&#x27;</span>, MultinomialNB())</span><br><span class="line">])</span><br></pre></td></tr></table></figure><p>整个<code>features</code>是一个FeatureUnion，而其中的ngram_tf_idf又是一个包括两步的pipeline。<br><img src="/images/15233302459256.jpg"></p><p>下面的例子中，使用FeatureUnion结合PCA降维后特征以及选择原特征中的几个作为特征组合再喂给SVM分类，最后用grid_search 做了 pca的<code>n_components</code>、SelectKBest的<code>k</code>以及SVM的<code>C</code>的CV。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.pipeline <span class="keyword">import</span> Pipeline, FeatureUnion</span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> GridSearchCV</span><br><span class="line"><span class="keyword">from</span> sklearn.svm <span class="keyword">import</span> SVC</span><br><span class="line"><span class="keyword">from</span> sklearn.datasets <span class="keyword">import</span> load_iris</span><br><span class="line"><span class="keyword">from</span> sklearn.decomposition <span class="keyword">import</span> PCA</span><br><span class="line"><span class="keyword">from</span> sklearn.feature_selection <span class="keyword">import</span> SelectKBest</span><br><span class="line"></span><br><span class="line">iris = load_iris()</span><br><span class="line"></span><br><span class="line">X, y = iris.data, iris.target</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(X.shape, y.shape)</span><br><span class="line"></span><br><span class="line"><span class="comment"># This dataset is way too high-dimensional. Better do PCA:</span></span><br><span class="line">pca = PCA()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Maybe some original features where good, too?</span></span><br><span class="line">selection = SelectKBest()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Build estimator from PCA and Univariate selection:</span></span><br><span class="line"></span><br><span class="line">svm = SVC(kernel=<span class="string">&quot;linear&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Do grid search over k, n_components and C:</span></span><br><span class="line"></span><br><span class="line">pipeline = Pipeline([(<span class="string">&quot;features&quot;</span>,</span><br><span class="line">                      FeatureUnion([(<span class="string">&quot;pca&quot;</span>, pca), (<span class="string">&quot;univ_select&quot;</span>,</span><br><span class="line">                                                   selection)])), (<span class="string">&quot;svm&quot;</span>,</span><br><span class="line">                                                                   svm)])</span><br><span class="line"></span><br><span class="line">param_grid = <span class="built_in">dict</span>(</span><br><span class="line">    features__pca__n_components=[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>],</span><br><span class="line">    features__univ_select__k=[<span class="number">1</span>, <span class="number">2</span>],</span><br><span class="line">    svm__C=[<span class="number">0.1</span>, <span class="number">1</span>, <span class="number">10</span>])</span><br><span class="line"></span><br><span class="line">grid_search = GridSearchCV(pipeline, param_grid=param_grid, verbose=<span class="number">10</span>)</span><br><span class="line">grid_search.fit(X, y)</span><br><span class="line"></span><br><span class="line">grid_search.best_estimator_</span><br><span class="line">grid_search.best_params_</span><br><span class="line">grid_search.best_score_</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;img src=&quot;/images/15231874915799.jpg&quot;&gt;&lt;/p&gt;</summary>
    
    
    
    
    <category term="Data Science" scheme="https://frankchen.xyz/tags/Data-Science/"/>
    
  </entry>
  
  <entry>
    <title>VPS搭建私人BT离线服务器</title>
    <link href="https://frankchen.xyz/2018/04/08/private-BT-server/"/>
    <id>https://frankchen.xyz/2018/04/08/private-BT-server/</id>
    <published>2018-04-08T03:13:51.000Z</published>
    <updated>2018-04-08T03:47:02.000Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/images/15231584798585.jpg"><br>使用闲置的VPS搭建私人BT离线服务器的方法，亦或者推广至树莓派或者家用路由器亦可。</p><span id="more"></span> <h2 id="安装及配置-Transmission"><a href="#安装及配置-Transmission" class="headerlink" title="安装及配置 Transmission"></a>安装及配置 Transmission</h2><ul><li>安装 <code>sudo apt-get install transmission-daemon</code></li><li>配置 停止服务（否则配置文件锁定，无法修改）<code>sudo service transmission-daemon stop</code></li><li>编辑配置文件</li></ul><p><code>sudo vim /etc/transmission-daemon/settings.json</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;ratio-limit&quot;</span>: 0.0100, </span><br><span class="line">    <span class="string">&quot;ratio-limit-enabled&quot;</span>: <span class="literal">true</span>,  </span><br><span class="line">    <span class="string">&quot;rpc-password&quot;</span>: <span class="string">&quot;*******&quot;</span>,   </span><br><span class="line">    <span class="string">&quot;rpc-username&quot;</span>: <span class="string">&quot;frank&quot;</span>,</span><br><span class="line">    <span class="string">&quot;download-dir&quot;</span>: <span class="string">&quot;/var/www/html/Downloads&quot;</span>, </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> 我只列出了我修改过且无法在 Transmission Web-GUI 中无法完成修改的几项，四项依次是下载完成做种率，开启限制做种率，Web-GUI 密码，Web-GUI 用户名。像保存路径，下载/ 上传速度限制，都可以在 Web-GUI 中直接设定，为了方便之后对下载文件的 Web 管理，我直接将保存路径改到了 Web 发布路径下的一个子目录。</p><p> 重启服务</p><p> <code>sudo service transmission-daemon start</code></p><p> 此时在浏览器打开<code>VPS的IP地址/域名:9091</code>并输入刚刚设置的用户名及密码应该就可以访问 Transmission 的 Web-GUI了。<br> <img src="/images/Screen%20Shot%202018-04-08%20at%2011.25.35.png" alt="Screen Shot 2018-04-08 at 11.25.35"></p><p> 可是在添加了第一个任务后出现保存路径写入权限的问题。<br>解决办法如<a href="https://askubuntu.com/questions/221081/permission-denied-when-downloading-with-transmission-deamon">Permission denied when downloading with transmission deamon - Ask Ubuntu</a>所示：</p><p>我们的下载地址是 <code>/var/www/html/Downloads</code> 用户名是<code>znwindy</code>:<br>那么 </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 将本用户加入 `debian-transmission`组</span></span><br><span class="line">sudo usermod -a -G debian-transmission znwindy</span><br><span class="line"><span class="comment"># 文件夹所有者</span></span><br><span class="line">sudo chgrp debian-transmission /var/www/html/Downloads</span><br><span class="line"><span class="comment"># 组添加写权限</span></span><br><span class="line">sudo chmod -R 755 /var/www</span><br><span class="line"><span class="comment"># 停止后台deamon </span></span><br><span class="line"></span><br><span class="line">sudo service transmission-daemon stop</span><br><span class="line"><span class="comment"># 更改 file creation mask</span></span><br><span class="line">sudo vim /etc/transmission-daemon/settings.json</span><br><span class="line"><span class="comment"># 把&quot;umask&quot;: 18 改为 &quot;umask&quot;: 2</span></span><br><span class="line"><span class="comment"># 重启服务</span></span><br><span class="line">sudo service transmission-daemon start</span><br></pre></td></tr></table></figure><p>即可解决写的问题。</p><h2 id="配置-Apache-加密区域"><a href="#配置-Apache-加密区域" class="headerlink" title="配置 Apache 加密区域"></a>配置 Apache 加密区域</h2><p>安装apache2</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install apache2</span><br></pre></td></tr></table></figure><p>Adjust the Firewall</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw app list</span><br><span class="line">sudo ufw allow <span class="string">&#x27;Apache Full&#x27;</span></span><br><span class="line">sudo ufw status</span><br><span class="line">sudo systemctl status apache2</span><br></pre></td></tr></table></figure><p>密码生成</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo htpasswd -c /etc/apache2/.htpasswd 用户名</span><br></pre></td></tr></table></figure><p>然后会被提示输入两次该 “用户名” 的密码。</p><p>修改虚拟 host 的配置文件<br><code>sudo vim /etc/apache2/sites-enabled/000-default.conf</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;Directory <span class="string">&quot;/var/www/html&quot;</span>&gt;</span><br><span class="line">        AuthType Basic</span><br><span class="line">        AuthName <span class="string">&quot;Restricted Content&quot;</span></span><br><span class="line">        AuthUserFile /etc/apache2/.htpasswd</span><br><span class="line">        Require valid-user</span><br><span class="line">&lt;/Directory&gt;</span><br></pre></td></tr></table></figure><p>保存后重启</p><p><code>sudo service apache2 restart</code></p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>通过 HTTP 将下载的任务取回本地，速度也很快！这样，通过访问 Transmission Web-GUI “投喂” 种子，磁力链，然后在下载完成后通过 HTTP 方式从 VPS 将资源取回本地，甚至直接对 .mp3、.mp4 等文件格式进行在线播放，实现了一个简化版的迅雷离线下载，可是它却在下载某些特定资源时远比迅雷离线管用。</p><h2 id="参考自"><a href="#参考自" class="headerlink" title="参考自"></a>参考自</h2><ul><li><a href="https://zhuanlan.zhihu.com/p/24478342">在 VPS 上搭建私人离线下载</a></li></ul>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;img src=&quot;/images/15231584798585.jpg&quot;&gt;&lt;br&gt;使用闲置的VPS搭建私人BT离线服务器的方法，亦或者推广至树莓派或者家用路由器亦可。&lt;/p&gt;</summary>
    
    
    
    
    <category term="Linux" scheme="https://frankchen.xyz/tags/Linux/"/>
    
    <category term="Old Driver" scheme="https://frankchen.xyz/tags/Old-Driver/"/>
    
  </entry>
  
  <entry>
    <title>numpy 中增加channel的方法</title>
    <link href="https://frankchen.xyz/2018/03/29/numpy-add-channel/"/>
    <id>https://frankchen.xyz/2018/03/29/numpy-add-channel/</id>
    <published>2018-03-29T12:15:30.000Z</published>
    <updated>2018-03-29T12:48:49.000Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/images/15223277046847.jpg"><br>numpy 数组中一维怎么转二维和多维？简述 numpy 中增加channel的方法。</p><span id="more"></span><p>在机器学习中，所有的数据都是向量和矩阵，而怎么根据我们所要解决的问题来调整模型以及数据的格式，也就是矩阵的维度和大小是一项重要的基本功，那么本文就具体介绍下numpy中数组的转换，也就是增加channel的方法。</p><h2 id="一维转二维"><a href="#一维转二维" class="headerlink" title="一维转二维"></a>一维转二维</h2><p>例如我们有一个一维的numpy array，有如下方法可以转为二维</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">a = np.arange(<span class="number">10</span>)</span><br><span class="line">a</span><br><span class="line">a.shape</span><br><span class="line">b = a[:,<span class="literal">None</span>]</span><br><span class="line">b</span><br><span class="line">b.shape</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">array([0, 1, 2, 3, 4, 5, 6, 7, 8, 9])</span></span><br><span class="line"><span class="string">(10,)</span></span><br><span class="line"><span class="string">array([[0],</span></span><br><span class="line"><span class="string">       [1],</span></span><br><span class="line"><span class="string">       [2],</span></span><br><span class="line"><span class="string">       [3],</span></span><br><span class="line"><span class="string">       [4],</span></span><br><span class="line"><span class="string">       [5],</span></span><br><span class="line"><span class="string">       [6],</span></span><br><span class="line"><span class="string">       [7],</span></span><br><span class="line"><span class="string">       [8],</span></span><br><span class="line"><span class="string">       [9]])</span></span><br><span class="line"><span class="string">(10, 1)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><p> 可以看到，<code>a</code>确实被转为了二维，以下方法是一样的：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line">c = a[:,np.newaxis]</span><br><span class="line">c</span><br><span class="line">(c == b).<span class="built_in">all</span>()</span><br><span class="line">np.newaxis == <span class="literal">None</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">array([[0],</span></span><br><span class="line"><span class="string">       [1],</span></span><br><span class="line"><span class="string">       [2],</span></span><br><span class="line"><span class="string">       [3],</span></span><br><span class="line"><span class="string">       [4],</span></span><br><span class="line"><span class="string">       [5],</span></span><br><span class="line"><span class="string">       [6],</span></span><br><span class="line"><span class="string">       [7],</span></span><br><span class="line"><span class="string">       [8],</span></span><br><span class="line"><span class="string">       [9]])</span></span><br><span class="line"><span class="string">True</span></span><br><span class="line"><span class="string">True</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="转为多维"><a href="#转为多维" class="headerlink" title="转为多维"></a>转为多维</h2><p>时间序列预测中，我们一般需要的是(sample，time_stamp，feature)的3 个channel的数据，即一个三维矩阵，包含若干个sample，每个sample包含若干个时间序列点，而每个时间序列点有包括若干个feature，哪怕我们只是做单变量的时间序列预测，输入RNN网络例如LSTM的时候，数据也必须是三维的格式，下面我们讲一讲这么做的方法。</p><p>例如我们有一个若干个时间点每个时间点有两个特征的数据，</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">a = np.arange(<span class="number">24</span>).reshape((-<span class="number">1</span>,<span class="number">2</span>))</span><br><span class="line">a.shape</span><br><span class="line">a</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">(12, 2)</span></span><br><span class="line"><span class="string">array([[ 0,  1],</span></span><br><span class="line"><span class="string">       [ 2,  3],</span></span><br><span class="line"><span class="string">       [ 4,  5],</span></span><br><span class="line"><span class="string">       [ 6,  7],</span></span><br><span class="line"><span class="string">       [ 8,  9],</span></span><br><span class="line"><span class="string">       [10, 11],</span></span><br><span class="line"><span class="string">       [12, 13],</span></span><br><span class="line"><span class="string">       [14, 15],</span></span><br><span class="line"><span class="string">       [16, 17],</span></span><br><span class="line"><span class="string">       [18, 19],</span></span><br><span class="line"><span class="string">       [20, 21],</span></span><br><span class="line"><span class="string">       [22, 23]])</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><p>我们将a转化为三个channel，即可以</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">b = a[:,<span class="literal">None</span>,:]</span><br><span class="line">b.shape</span><br><span class="line">b</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">(12, 1, 2)</span></span><br><span class="line"><span class="string">array([[[ 0,  1]],</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">       [[ 2,  3]],</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">       [[ 4,  5]],</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">       [[ 6,  7]],</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">       [[ 8,  9]],</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">       [[10, 11]],</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">       [[12, 13]],</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">       [[14, 15]],</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">       [[16, 17]],</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">       [[18, 19]],</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">       [[20, 21]],</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">       [[22, 23]]])</span></span><br><span class="line"><span class="string">       &#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><p>以上对应着pandas的Dataframe，及我们对Dataframe取values属性，会得到一个二维矩阵，做法就如同上面一样，但是如果是Series的话，取values属性得到的是一个一维的，这时候我们的做法则是，</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">c = np.arange(<span class="number">12</span>)</span><br><span class="line">c</span><br><span class="line">d = c[:,<span class="literal">None</span>,<span class="literal">None</span>]</span><br><span class="line">d.shape</span><br><span class="line">d</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">array([ 0,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11])</span></span><br><span class="line"><span class="string">(12, 1, 1)</span></span><br><span class="line"><span class="string">array([[[ 0]],</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">       [[ 1]],</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">       [[ 2]],</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">       [[ 3]],</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">       [[ 4]],</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">       [[ 5]],</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">       [[ 6]],</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">       [[ 7]],</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">       [[ 8]],</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">       [[ 9]],</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">       [[10]],</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">       [[11]]])</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="减少维度"><a href="#减少维度" class="headerlink" title="减少维度"></a>减少维度</h2><p>若要减少数据的维度，我们可以用的方法如下，</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">d = np.arange(<span class="number">12</span>)[:,<span class="literal">None</span>,<span class="literal">None</span>]</span><br><span class="line">d.shape</span><br><span class="line">d</span><br><span class="line">e = np.squeeze(d)</span><br><span class="line">e.shape</span><br><span class="line">e</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;(12, 1, 1)</span></span><br><span class="line"><span class="string">array([[[ 0]],</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">       [[ 1]],</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">       [[ 2]],</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">       [[ 3]],</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">       [[ 4]],</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">       [[ 5]],</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">       [[ 6]],</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">       [[ 7]],</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">       [[ 8]],</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">       [[ 9]],</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">       [[10]],</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">       [[11]]])</span></span><br><span class="line"><span class="string">(12,)</span></span><br><span class="line"><span class="string">array([ 0,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11])&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;img src=&quot;/images/15223277046847.jpg&quot;&gt;&lt;br&gt;numpy 数组中一维怎么转二维和多维？简述 numpy 中增加channel的方法。&lt;/p&gt;</summary>
    
    
    
    
    <category term="python" scheme="https://frankchen.xyz/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>python 正则实用例子</title>
    <link href="https://frankchen.xyz/2018/02/24/re-basic-of-python/"/>
    <id>https://frankchen.xyz/2018/02/24/re-basic-of-python/</id>
    <published>2018-02-24T10:52:00.000Z</published>
    <updated>2018-02-24T11:09:45.000Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/images/15194705842254.png"></p><p>本文主要关于python的正则表达式的符号与方法。</p><span id="more"></span><ul><li>findall: 找寻所有匹配，返回所有组合的列表</li><li>search: 找寻第一个匹配并返回</li><li>sub: 替换符合规律的内容，并返回替换后的内容</li></ul><p>**.**：匹配除了换行符以外的任意字符</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="string">&#x27;xy123&#x27;</span></span><br><span class="line">b = re.findall(<span class="string">&#x27;x...&#x27;</span>,a)</span><br><span class="line"><span class="built_in">print</span>(b)</span><br><span class="line"><span class="comment"># [&#x27;xy12&#x27;]</span></span><br></pre></td></tr></table></figure><p>*****：匹配前一个字符0次或者无限次</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="string">&#x27;xyxy123&#x27;</span></span><br><span class="line">b = re.findall(<span class="string">&#x27;x*&#x27;</span>,a)</span><br><span class="line"><span class="built_in">print</span>(b)</span><br><span class="line"><span class="comment"># [&#x27;x&#x27;, &#x27;&#x27;, &#x27;x&#x27;, &#x27;&#x27;, &#x27;&#x27;, &#x27;&#x27;, &#x27;&#x27;, &#x27;&#x27;]</span></span><br></pre></td></tr></table></figure><p>**?**：匹配前一个字符0次或者1次</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="string">&#x27;xy123&#x27;</span></span><br><span class="line">b = re.findall(<span class="string">&#x27;x?&#x27;</span>,a)</span><br><span class="line"><span class="built_in">print</span>(b)</span><br><span class="line"><span class="comment"># [&#x27;x&#x27;, &#x27;&#x27;, &#x27;&#x27;, &#x27;&#x27;, &#x27;&#x27;, &#x27;&#x27;]</span></span><br></pre></td></tr></table></figure><p>**.***：贪心算法</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">b = re.findall(<span class="string">&#x27;xx.*xx&#x27;</span>,secret_code)</span><br><span class="line"><span class="built_in">print</span>(b)</span><br><span class="line"><span class="comment"># [&#x27;xxIxxfasdjifja134xxlovexx23345sdfxxyouxx&#x27;]</span></span><br></pre></td></tr></table></figure><p>**.*?**：非贪心算法</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">c = re.findall(<span class="string">&#x27;xx.*?xx&#x27;</span>,secret_code)</span><br><span class="line"><span class="built_in">print</span>(c)</span><br><span class="line"><span class="comment"># [&#x27;xxIxx&#x27;, &#x27;xxlovexx&#x27;, &#x27;xxyouxx&#x27;]</span></span><br></pre></td></tr></table></figure><p>**()**：括号内结果返回</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">d = re.findall(<span class="string">&#x27;xx(.*?)xx&#x27;</span>,secret_code)</span><br><span class="line"><span class="built_in">print</span>(d)</span><br><span class="line"><span class="keyword">for</span> each <span class="keyword">in</span> d:</span><br><span class="line">    <span class="built_in">print</span>(each)</span><br><span class="line"><span class="comment"># [&#x27;I&#x27;, &#x27;love&#x27;, &#x27;you&#x27;]</span></span><br><span class="line"><span class="comment"># I</span></span><br><span class="line"><span class="comment"># love</span></span><br><span class="line"><span class="comment"># you</span></span><br></pre></td></tr></table></figure><p><strong>re.S</strong>使得.的作用域包括换行符”\n”</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">s = <span class="string">&#x27;&#x27;&#x27;sdfxxhello</span></span><br><span class="line"><span class="string">xxfsdfxxworldxxasdf&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">d = re.findall(<span class="string">&#x27;xx(.*?)xx&#x27;</span>,s,re.S)</span><br><span class="line"><span class="built_in">print</span>(d)</span><br><span class="line"><span class="comment">#  [&#x27;hello\n&#x27;, &#x27;world&#x27;]</span></span><br></pre></td></tr></table></figure><p>对比findall与search的区别</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">s2 = <span class="string">&#x27;asdfxxIxx123xxlovexxdfd&#x27;</span></span><br><span class="line">f = re.search(<span class="string">&#x27;xx(.*?)xx123xx(.*?)xx&#x27;</span>,s2).group(<span class="number">2</span>)</span><br><span class="line"><span class="built_in">print</span>(f)</span><br><span class="line">f2 = re.findall(<span class="string">&#x27;xx(.*?)xx123xx(.*?)xx&#x27;</span>,s2)</span><br><span class="line"><span class="built_in">print</span>(f2[<span class="number">0</span>][<span class="number">1</span>])</span><br><span class="line"><span class="comment"># love</span></span><br><span class="line"><span class="comment"># love</span></span><br></pre></td></tr></table></figure><p>虽然两者结果相同，但是search是搭配group来得到第二个匹配，而findall的结果是[(‘I’, ‘love’)]，包含元组的列表，所以需要f2[0][1]来引入。</p><p><strong>sub</strong>的使用</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">s = <span class="string">&#x27;123rrrrr123&#x27;</span></span><br><span class="line">output = re.sub(<span class="string">&#x27;123(.*?)123&#x27;</span>,<span class="string">&#x27;123%d123&#x27;</span>%<span class="number">789</span>,s)</span><br><span class="line"><span class="built_in">print</span>(output)</span><br><span class="line"><span class="comment"># 123789123</span></span><br></pre></td></tr></table></figure><p>例如我们需要将文档中的所有的png图片改变路径，即需要找到所有的<code>.png</code>结尾，再将其都加上路径，</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">multiply</span>(<span class="params">m</span>):</span></span><br><span class="line">    <span class="comment"># Convert group 0 to an integer.</span></span><br><span class="line">    v = m.group(<span class="number">0</span>)</span><br><span class="line">    <span class="built_in">print</span>(v)</span><br><span class="line">    <span class="comment"># Multiply integer by 2.</span></span><br><span class="line">    <span class="comment"># ... Convert back into string and return it.</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;basic/&#x27;</span>+v)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;basic/&#x27;</span>+v</span><br></pre></td></tr></table></figure><p>结果如下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>autoencoder.png</span><br><span class="line">    basic/autoencoder.png</span><br><span class="line">    RNN.png</span><br><span class="line">    basic/RNN.png</span><br><span class="line">    rnn_step_forward.png</span><br><span class="line">    basic/rnn_step_forward.png</span><br><span class="line">    rnns.png</span><br><span class="line">    basic/rnns.png</span><br><span class="line">    rnn_cell_backprop.png</span><br><span class="line">    basic/rnn_cell_backprop.png</span><br><span class="line">    LSTM.png</span><br><span class="line">    basic/LSTM.png</span><br><span class="line">    LSTM_rnn.png</span><br><span class="line">    basic/LSTM_rnn.png</span><br><span class="line">    attn_mechanism.png</span><br><span class="line">    basic/attn_mechanism.png</span><br><span class="line">    attn_model.png</span><br><span class="line">    basic/attn_model.png</span><br></pre></td></tr></table></figure><p>仿照上面案例，我们可以方便的对我们的任务进行定制。</p><p><strong>subn</strong> 相比sub，subn返回元组，第二个元素表示替换发生的次数：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">m</span>):</span></span><br><span class="line">    <span class="comment"># Convert.</span></span><br><span class="line">    v = <span class="built_in">int</span>(m.group(<span class="number">0</span>))</span><br><span class="line">    <span class="comment"># Add 2.</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">str</span>(v + <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Call re.subn.</span></span><br><span class="line">result = re.subn(<span class="string">&quot;\d+&quot;</span>, add, <span class="string">&quot;1 2 3 4 5&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Result string:&quot;</span>, result[<span class="number">0</span>])</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Number of substitutions:&quot;</span>, result[<span class="number">1</span>])</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span></span><br><span class="line">Result string: <span class="number">11</span> <span class="number">21</span> <span class="number">31</span> <span class="number">41</span> <span class="number">51</span></span><br><span class="line">Number of substitutions: <span class="number">5</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;img src=&quot;/images/15194705842254.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;本文主要关于python的正则表达式的符号与方法。&lt;/p&gt;</summary>
    
    
    
    
    <category term="python" scheme="https://frankchen.xyz/tags/python/"/>
    
    <category term="re" scheme="https://frankchen.xyz/tags/re/"/>
    
  </entry>
  
  <entry>
    <title>Tex 写（中文）毕业论文全攻略</title>
    <link href="https://frankchen.xyz/2018/02/08/Writing-Graduation-Thesis-in-Tex/"/>
    <id>https://frankchen.xyz/2018/02/08/Writing-Graduation-Thesis-in-Tex/</id>
    <published>2018-02-07T17:36:41.000Z</published>
    <updated>2018-02-07T18:11:41.000Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/images/15180252634406.png"></p><p>用 Tex 写（中文）毕业论文全攻略，高效、便捷、优雅！</p><span id="more"></span><p>这里我们并不存在鄙视链，说什么Tex 优于 Word之类的，其实Word作为极其复杂的文本处理软件，我相信Tex能做到的，Word一定有其实现方式，只不过大部分人都只会用到Word的一小部分功能，相比Word，Tex解决方案更加便捷优雅，比如自动排号（章节、表格、参考文献的编号），全局设置的字体、间距格式等等。相比Word事无巨细的维护修改成本，Tex 的解决方案更加programmer，即软件开发，后期主要工作是迭代维护，若能在前期即考虑这点，后期能省下极多的脑细胞和精力。好了不说多，发车吧~</p><h2 id="总论"><a href="#总论" class="headerlink" title="总论"></a>总论</h2><p> 总体来说，是用上交Tex模板结合Atom编辑器在本地编辑<a href="https://atom.io/">Atom</a>（这个用什么编辑器随意）以及Dropbox同步到云端<a href="https://www.dropbox.com/h">Dropbox</a>以及云端上在sharelatex服务器上即时编译所见即所得。</p><h2 id="工具使用方法"><a href="#工具使用方法" class="headerlink" title="工具使用方法"></a>工具使用方法</h2><p>首先我们在sharelatex官网<a href="https://www.sharelatex.com/project">Your Projects - ShareLaTeX, Online LaTeX Editor</a>注册账号，免费账号即可，如果需要多人协作可以用邀请小号的方式让自己增加权限（sharelatex新建账号不验证邮箱。。所以你懂的），接下来在上交模板<a href="https://github.com/sjtug/SJTUThesis">sjtug/SJTUThesis: 上海交通大学 XeLaTeX 学位论文模板 A XeLaTeX template for Shanghai Jiao Tong University (SJTU) thesis.</a>处点击此处添加最新版模板到我们的sharelatex项目，<br><img src="/images/Screen%20Shot%202018-02-08%20at%2001.58.25.png" alt="Screen Shot 2018-02-08 at 01.58.25"></p><p><img src="/images/Screen%20Shot%202018-02-08%20at%2001.58.56.png" alt="Screen Shot 2018-02-08 at 01.58.56"></p><p>如图，再点进去，先别急着修改，我们先设置个网盘同步，Dropbox需要梯子，在sharelatex的账号设置处链接到Dropbox，<br><img src="/images/Screen%20Shot%202018-02-08%20at%2002.00.57.png" alt="Screen Shot 2018-02-08 at 02.00.57"></p><p>同时Dropbox安装一个桌面版，需要设置代理，<br><img src="/images/Screen%20Shot%202018-02-08%20at%2002.02.29.png" alt="Screen Shot 2018-02-08 at 02.02.29"><br>如图，我们使用ss作为代理。</p><p>接下来安装Atom编辑器，在插件里装一个如下插件，这里我们需要它只是为了注释这一个功能，因为我们不需要本地编译。<br><img src="/images/Screen%20Shot%202018-02-08%20at%2002.03.38.png" alt="Screen Shot 2018-02-08 at 02.03.38"></p><p>接下来我们就可以在本地用Atom编辑Dropbox网盘在本地的Tex项目，只要我们保存，Dropbox就会同步到sharelatex，如果开启自动编译云端就会展示当下编译的PDF效果，如图<br><img src="/images/Screen%20Shot%202018-02-08%20at%2002.07.11.png" alt="Screen Shot 2018-02-08 at 02.07.11"></p><h2 id="Tex模板使用说明"><a href="#Tex模板使用说明" class="headerlink" title="Tex模板使用说明"></a>Tex模板使用说明</h2><p>详见此处<a href="http://sjtug.org/SJTUThesis/README.pdf">README.pdf</a>，主要思路就是把各章、摘要、参考文献等分为不同的tex文件，图表等资源放在一处文件夹内，逐个引用，有全局的的设置文件，编译时将这些零件拼接为pdf，后续会添加更多心得。</p><h2 id="资料"><a href="#资料" class="headerlink" title="资料"></a>资料</h2><ol><li><a href="https://math.meta.stackexchange.com/questions/5020/mathjax-basic-tutorial-and-quick-reference">MathJax basic tutorial and quick reference - Mathematics Meta Stack Exchange</a>：一个常用Latex公式符号的全集</li><li>如果上面没找到，可以试试这里，手写识别latex字符<a href="http://detexify.kirelabs.org/classify.html">Detexify LaTeX handwritten symbol recognition</a></li></ol>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;img src=&quot;/images/15180252634406.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;用 Tex 写（中文）毕业论文全攻略，高效、便捷、优雅！&lt;/p&gt;</summary>
    
    
    
    
    <category term="Tex" scheme="https://frankchen.xyz/tags/Tex/"/>
    
  </entry>
  
</feed>
